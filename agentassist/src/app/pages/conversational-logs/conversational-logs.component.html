<app-slider-component id="convsLogSilder" #newConvSlider='app-slider' class="conv-history-log-slider">
  <app-convs-history-logs *ngIf="showConversation" (onClose)="closeConvsHistorySlider($event)" [conversationId]="conversationId"></app-convs-history-logs>
</app-slider-component>

<div class="conversational-logs-wrappper-content">
    <div class="header-info-title">
        <div class="title">Conversation Logs</div>
        <div class="desc-text">Library of conversations  you have had with your customers</div>
    </div>
    <perfect-scrollbar class="scroll-tabs" #psTableView (psYReachEnd)="onReachEnd()" [config]="{useBothWheelAxes: true, suppressScrollX: false, suppressScrollY: false}">
        <div class="scroll-data-info">
            <div class="data-content-wrapper">
                <div class="search-header">
                    <div class="custom_date_picker_sec date-sec ngx-daterangepicker-action" (click)="openPicker()">
                        <i class="icon-sa-calendar ngx-daterangepicker-action" (click)="openPicker()"></i>
                        <input type="text"
                            readonly
                            ngxDaterangepickerMd
                            [timePicker]="true"
                            [alwaysShowCalendars]="true"
                            [keepCalendarOpeningWithRange]="true"
                            [ranges]="ranges"
                            [showCustomRangeLabel]="true"
                            [showRangeLabelOnInput]="true"
                            [linkedCalendars]="true"
                            showCancel="true"
                            [locale]="{format: 'DD/MM/YYYY hh:mm', displayFormat: 'MM/DD/YYYY hh:mm A'}"
                            [isInvalidDate]="isInvalidDate"
                            [(ngModel)]="selected"
                            class="input-date-custom"
                            [locale] = "calendarLocale"
                            (datesUpdated)="onDatesUpdated($event)"/>
                        <img src="assets/icons/analytics/carrotup.svg" alt="not found" class="ml-2 mr-0 ngx-daterangepicker-action" (click)="openPicker()">
                    </div>
                    <div class="kr-sg-input-search">
                        <input type="text" placeholder="Search" class="input-search" name="userSearch" id="searchConv" #searchTerm (keydown.enter)="save($event)">
                        <i class="icon-sa-search search-icon"></i>
                    </div>
                </div>
                <div class="table-data-info">
                    <div class="table-hader-wrapper">
                          <div *ngIf="sortConvsIds === 'desc'" class="title w-20">ConversaTion ID <i class="icon-sa-arrow-left" (click)="convsIdSorting('asc')"></i></div>
                          <div *ngIf="sortConvsIds === 'asc'" class="title w-20">ConversaTion ID <i class="icon-sa-arrow-right" (click)="convsIdSorting('desc')"></i></div>
                          <div *ngIf="sortConvsLogsByTime === 'desc'" class="title w-15">tIME <i class="icon-sa-arrow-left" (click)="sortingConvLogsByTime('asc')"></i></div>
                          <div *ngIf="sortConvsLogsByTime === 'asc'" class="title w-15">tIME <i class="icon-sa-arrow-right" (click)="sortingConvLogsByTime('desc')"></i></div>
                          <!-- <div class="title w-15">AGENT</div> -->
                          <div class="title w-20">AUTOMATIONS</div>
                          <div class="title w-15">CHANNEL</div>
                          <div class="title w-15">DURATION</div>
                    </div>
                    <ng-container>
                        <!-- <div class="table-body-wrapper"  *ngFor="let data of realconvs" (click)="openConvsHistorySlider($event, data)">
                            <div class="text-title w-17" >{{data.conversationId}}</div>
                            <div class="title-text w-12" >{{data.startedOn}}</div>
                            <div class="title-text w-11" >{{data?.agent}}</div>
                            <div class="title-text-info w-16" >
                                <span class="m-r-5" *ngFor="let ele of data.automations" >{{ele}}</span>
                                <span class="link-others" >+2 others</span>
                            </div>
                            <div class="title-text w-10" >{{data.channel}}</div>
                            <div class="title-text w-10">{{data.duration}}</div>
                            <div class="status-text open-status w-10" >
                                <span >Open</span>
                            </div>
                            <div class="download-action w-14" >
                                <div class="download-icon" >
                                    <i class="icon-sa-comment" ></i>
                                </div>
                            </div>
                        </div> -->
                        <div *ngIf="transformedConvsLogs.length > 0">
                          <div class="table-body-wrapper"  *ngFor="let data of transformedConvsLogs" (click)="openConvsHistorySlider($event, data)">
                            <div class="text-title w-20 text-truncate">{{data.conversationId}}</div>
                            <div class="title-text w-15 text-truncate">{{data.start}}</div>
                            <!-- <div class="title-text w-15">{{data?.agent}}</div> -->
                            <div class="title-text-info w-20">
                                <span class="m-r-5" *ngFor="let ele of data?.automations?.slice(0,2)" >{{ele}}</span>
                                <span class="link-others" *ngIf="data?.automations?.length>2" ngbTooltip="{{ data.automations.slice(2).join(',')}}">+{{data?.automations?.length-2}} others</span>
                            </div>
                            <div class="title-text w-15">{{data.channel}}</div>
                            <div class="title-text w-15">{{durationCalc(data.duration)}}</div>
                        </div>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="this.transformedConvsLogs.length == 0">
                        <div class="empty-results-data" *ngIf="this.isSearched && this.transformedConvsLogs.length == 0">
                            <div class="img-block">
                                <img src="assets/images/conv-logs/search-no-results.svg">
                            </div>
                            <div class="title">No results found</div>
                            <div class="text-desc">No results found for your query “{{seachedConvsId}}”</div>
                        </div>
                        <div class="empty-results-data" *ngIf="this.isDatePicked && this.transformedConvsLogs.length == 0">
                            <div class="img-block">
                                <img src="assets/images/conv-logs/no-results-calendar.svg">
                            </div>
                            <div class="title">No results found</div>
                            <div class="text-desc">Could not find any result for the selected date range <span>“{{selected.startDate.toISOString() | date}} - {{this.selected.endDate.toISOString() | date}}”</span></div>
                        </div>
                        <div class="empty-results-data" *ngIf="this.transformedConvsLogs.length == 0 && !this.isSearched && !this.isDatePicked">
                            <div class="img-block">
                                <img src="assets/images/conv-logs/no-comments.svg">
                            </div>
                            <div class="title no-conv-title">There are no conversations to show</div>
                            <div class="text-desc no-conv-desc">You have had no conversation with your customers yet. Conversations log records the transcript, decisions and interactions made while chatting with your customers.</div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </perfect-scrollbar>
</div>
