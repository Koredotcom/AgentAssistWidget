<div id="callHistoryDetails">
  <div class="sliderContainer width500 callHistory">
    <div class="sliderBody pt-0" [ngClass]="{'agent-chat-hist': isAgent}">   
      <div *ngIf="isLoadingAudio" class="load-logs">
        <mat-spinner diameter="18"></mat-spinner>
        {{ "CONVERSATIONAL_LOGS.LOADING_AUDIO_STREAM" | translate }}
      </div> 
      <div *ngIf="!isLoadingAudio && !audioURL" class="load-logs">
        <span *ngIf="selectedLog?.scId">{{"CONVERSATIONAL_LOGS.NO_AUDIO_FOUND" | translate}}</span>
      </div>
      <div *ngIf="!isLoadingAudio && audioURL" class="audio-record-stream">
        <!-- <div class="user-face-">
          <img src="assets/icons/conversational-logs/botface.svg">{{"DIALOGLIST.BOT" | translate}}
        </div>
        <div class="bot-face-">
          <img src="assets/icons/conversational-logs/userface.svg">{{"CONVERSATIONAL_LOGS.USER" | translate}} 
        </div> -->
        <div id="waveform" class="position-relative"></div>
        <div class="actions-udio-records">
          <div class="speed-audio">
            <img class="img-time-lap" src="assets/icons/conversational-logs/time-lap.svg">
            <div class="kr-sg-dropdowns">
              <div class="dropdown dropdown-open">
                  <button class="dropdown-toggle dropdown-input" ngbTooltip="Speed" data-bs-toggle="dropdown">{{audioSpeed}}</button>                                            
                  <ul class="dropdown-menu content-menu">                                               
                    <li (click)="onAudioSpeedChange(0.5)"><a>0.5</a></li>
                    <li (click)="onAudioSpeedChange(0.7)"><a>0.7</a></li>
                    <li (click)="onAudioSpeedChange(1)"><a>1</a></li>
                    <li (click)="onAudioSpeedChange(1.5)"><a>1.5</a></li>
                    <li (click)="onAudioSpeedChange(1.75)"><a>1.75</a></li>
                  </ul>
              </div>
            </div>
          </div>
          <div class="audio-volume-block">
            <img class="audio-volume-image" [class.d-none]="isAudioMute" ngbTooltip="Mute" (click)="setMute(true)" src="assets/icons/conversational-logs/volume.svg">
            <img class="audio-volume-image" [class.d-none]="!isAudioMute" ngbTooltip="UnMute" (click)="setMute(false)" src="assets/icons/conversational-logs/mute.svg">
            <div class="volume-slider">
              <mat-slider min="0" max="1" step="0.1" [(ngModel)]="audioVolume" (change)="onVolumeChange($event)" ></mat-slider>
            </div>
          </div>
          <div class="play-ause-forward">
            <button class="border-0"  ngbTooltip="Previous" [disabled]="audioIndex == 0" (click)="playPrevious()"><<</button>
            <img class="bckward" ngbTooltip="Backward" (click)="backward()" src="assets/icons/conversational-logs/backward.svg">
            <img class="play-pause" [class.d-none]="isAudioPlaying" ngbTooltip="Play" (click)="play()" src="assets/icons/conversational-logs/play-audio.svg">
            <img class="play-pause" [class.d-none]="!isAudioPlaying" ngbTooltip="Pause" (click)="play()" src="assets/icons/conversational-logs/pause-audio.svg">
            <img class="forward" ngbTooltip="Forward" (click)="forward()" src="assets/icons/conversational-logs/forward.svg">
            <button class="border-0 ml-1" ngbTooltip="Next" [disabled]="audioIndex == audioURLList?.length-1" (click)="playNext()">>></button>
          </div>
          <div class="download-audio" ngbTooltip="Download" (click)="download()">
            <img src="assets/icons/conversational-logs/download.svg">{{"BUTTONS.DOWNLOAD" | translate}}
          </div>
          <div class="time-duration-audio" ngbTooltip="Duration">
            <img src="assets/icons/conversational-logs/time.svg">{{getAudioRunningTime()}} / {{getAudioTime()}}
          </div>
        </div>
      </div>
      <perfect-scrollbar class="scroll-history-tab" [ngClass]="{'adjust-height': !audioURL}">
        <div class="tab-content">
          <div id="chathistory" class="tab-pane active pb-5">
            <div class="botchatHistoryContainer">
              <div [attr.data-msg-id]="message._id" *ngFor="let message of chatHistData.messages; let i = index;" id="{{message._id}}" [ngClass]="{'userMessageContainer':message.type==='incoming'}">
                  <div class="time">{{helpers.formatDate(message.createdOn)}}</div>
                  <div *ngIf="message.type==='outgoing'" class="botResponse response" [ngClass]="{'active': (message._id == msgId || msgIds?.indexOf(message._id) > -1)}">
                      <div class="imgDiv">
                        <img src="assets/images/bot-icon.svg">
                      </div>
                      <div *ngIf="!checkForTemplate(message.components[0].data.text)" class="msg" [innerHtml]="helpers.convertMDtoHTML(message.components[0].data.text,'bot')"></div>
                      <div *ngIf="checkForTemplate(message.components[0].data.text)" class="template" (ngInit)="renderTemplate(message,$element)"></div>
                      <div *ngIf="checkForTemplate(message.components[0].data.text)" (click)="showJSON(message)" class="openJavascriptIcon fa fa-ellipsis-h"></div>
                  </div>
                  <div *ngIf="message.type==='incoming'" class="userMessage response" [ngClass]="{'active': (message._id == msgId || msgIds?.indexOf(message._id) > -1)}">
                      <div class="msg" ng-class="{'borderOrange':originalIntent?.msgId===message._id}" [innerHtml]="helpers.convertMDtoHTML(message.components[0].data.renderMsg?message.components[0].data.renderMsg:message.components[0].data.text,'user')"></div>
                      <img src="assets/images/user-icon.svg">
                      <div class="sub-title-contain">
                        <span class="message" *ngIf="chatHistData.messages[i+1]?.tN">
                            {{'INT' | translate}}: {{chatHistData.messages[i+1].tN}} 
                        </span>
                      </div>
                  </div>
                  <div *ngIf="message.type === 'timelinemsg'" class="timeLineMsg">
                    <div class="userTransferedAgent" *ngIf="message.ms == 5">
                        <hr><span>{{'USER_TRANSFERRED_AGENT' | translate}}</span>
                    </div>
                        <div class="userDroppedOff" *ngIf="message.ms == 6">
                            <hr><span>{{'USER_DROPPED_OFF' | translate}}</span>
                        </div>
                  </div>
                  <div class="entityMatched" *ngIf="originalIntent?.msgId===message._id">{{winningIntentData}}</div>
              </div>
              <!-- <div class="noHistory" ng-show="chatHistData.messages.length === 0">no chat history</div> -->
            </div>
          </div>         
        </div>
      </perfect-scrollbar>
    </div>
  </div>
</div>
<div class="jsonResponseContainer">
  <div class="text">{{'JS_MSG' | translate}}</div>
  <div class="closeBtn"><span class="fa fa-close" (click)="closeChatHistoryJsonModal()"></span></div>
  <div class="jsonPreTag">
    <perfect-scrollbar>
      <pre id="chatHistoryJson" style="height: calc(100vh - 120px);"></pre>
    </perfect-scrollbar>
  </div>
</div>