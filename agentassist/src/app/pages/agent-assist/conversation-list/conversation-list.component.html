<div class="conversation-list">
    <div class="dep-uc-table mt-2">
        <div class="smart-filters">
            <!--Left Column-->
            <div class="col-7 filterLeft">
                <div class="kr-sg-dropdowns" ngbDropdown [placement]="'bottom-left'">
                    <div class="dropdown dropdown-open">
                        <button class="dropdown-toggle dropdown-input" ngbDropdownToggle>
                            <img src="assets/icons/filterBy.svg">
                            <span class="name">{{selectedGroup}}</span>
                            <img src="assets/icons/bropdown-green.svg" class="dropdown-green">
                        </button>
                        <ul class="dropdown-menu content-menu header_in_development_drpdown" ngbDropdownMenu>
                            <li ngbDropdownItem (click)="selectGroup('');isGrouped = false; agentAssistService.isUCGrouped = false;"><a>{{ "USECASES.NONE" | translate }}</a></li>
                            <li ngbDropdownItem (click)="selectGroup('category')"><a>{{ "USECASES.CATEGORY" | translate }}</a></li>
                            <li ngbDropdownItem (click)="selectGroup('state')"><a>{{ "USECASES.STATUS_SMALL" | translate }}</a></li>
                        </ul>
                    </div>
                </div>
                <div class="tabs-filters d-none">
                    <div class="t-name active-t">{{"AGENTASSIST.ALL" | translate}}</div>
                    <div class="t-name">{{"AGENTASSIST.CONTACT_AGENT" | translate}}</div>
                    <div class="t-name">{{"AGENTASSIST.AGENT_TO_BOT" | translate}}</div>
                </div>
                <!--Filter by-->
            </div>
            <!--Left Column-->

            <!--Right Column-->
            <div class="col-5 filterRight">
                <!--Search-->
                <div class="kr-sg-input-inline-search" [hidden]="isGrouped">
                    <input type="text" [placeholder]="'PLACEHOLDERS.SEARCH' | translate" class="input-search" #searchTerm>
                    <img src="assets/icons/search.svg" class="search-icon">
                </div>
                <!--Search-->
                <!--3dots-->

                <div class="kr-sg-dropdowns d-none" ngbDropdown [placement]="'bottom-right'" container="body">
                    <div class="dropdown dropdown-open">
                        <button class="dropdown-toggle dropdown-input" ngbDropdownToggle>
                            <img src="assets/icons/skills/overflow.svg">
                        </button>
                        <ul class="dropdown-menu content-menu skills-edit-delete-dropdown" ngbDropdownMenu>
                            <li><a>{{"USECASES.EDIT" | translate}}</a></li>
                            <li><a>{{"USECASES.DELETE" | translate}}</a></li>
                        </ul>
                    </div>
                </div>
                <!--3dots-->
            </div>
            <!--Right Column-->
        </div>
        <!--FILTERS-->
    </div>
    <div class="tab-content">
        <div class="qa-ans-table-data-content" *ngIf="!isGrouped">
            <div class="qa-ans-table-header row col-12">
                <div class="title col-3 pl-5">{{"INTENT" | translate}}</div>
                <div class="title col-3">{{"USECASES.CATEGORY" | translate}}</div>
                <div class="title col-3">{{"ANALYTICS.UTTERANCES" | translate}}</div>
                <div class="title col-2">{{"ANALYTICS.CHATS" | translate}}</div>
                <div class="title col-1">{{"CONVERSATIONAL_LOGS.STATUS" | translate}}</div>
            </div>
            <perfect-scrollbar class="scroll-tabs" #psTableView (psYReachEnd)="onReachEnd()">
                <div class='init-loading' *ngIf="isLoading">
                    <mat-spinner diameter="25" strokeWidth="3"></mat-spinner>
                </div>
                <ng-container *ngIf="!isLoading">
                    <!-- <app-uc--table-rows *ngFor="let usecase of ucListDg; let i=index;" [usecase]="usecase" [i]="i"> -->
                    <ng-container *ngFor="let usecase of usecases; let i = index">
                        <ng-container *ngTemplateOutlet="usecaseRowTemplate; context: {usecase:usecase, i:i}"></ng-container>
                    </ng-container>


                    <div class="loading" *ngIf="agentAssistService.moreUCAvailable">
                        <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
                        <span class="wait-message">{{ "USECASES.LOADING" | translate }}</span>
                    </div>
                    <app-empty-screens [isSearch]="true" *ngIf="usecases.length == 0 && searchTerm?.value?.length"></app-empty-screens>
                    <app-empty-screens [isSearch]="false" *ngIf="usecases.length == 0 && !searchTerm?.value?.length"></app-empty-screens>
                </ng-container>

            </perfect-scrollbar>
        </div>

        <div *ngIf="isGrouped" class="group-by-active">
            <perfect-scrollbar class="scroll-tabs">
                <div *ngIf="groupBy == 'category'">
                    <div *ngIf="isCategoriesLoading" style="padding: 100px 50%;">
                        <mat-spinner diameter="18"></mat-spinner>
                    </div>
                    <div *ngIf="!isCategoriesLoading && !noResults">

                        <ng-container *ngFor="let c of categories; let i = index">
                            <ng-container *ngTemplateOutlet="ucGroupByTemplate; context: {category:c, isCategory: true}"></ng-container>
                        </ng-container>

                        <!-- <app-uc-groupby *ngFor="let c of categories" [category]="c" [isCategory]="true" [type]="'isAgentAssistOnly'"></app-uc-groupby> -->
                    </div>
                    <div *ngIf="noResults">
                        <app-empty-screens [isSearch]="false"></app-empty-screens>
                    </div>
                </div>
                <div *ngIf="groupBy == 'state'">
                    <div *ngIf="isStateLoading" style="padding: 100px 50%;">
                        <mat-spinner diameter="18"></mat-spinner>
                    </div>
                    <div *ngIf="!isStateLoading">
                        <ng-container *ngFor="let a of appStatesList; let i = index">
                            <ng-container *ngTemplateOutlet="ucGroupByTemplate; context: {category:a, isCategory: false}"></ng-container>
                        </ng-container>
                        <!-- <app-uc-groupby *ngFor="let a of appStatesList" [category]="a" [isCategory]="false"></app-uc-groupby> -->
                    </div>
                </div>
            </perfect-scrollbar>
        </div>
    </div>
</div>

<ng-template #usecaseRowTemplate let-usecase='usecase' let-i='i'>
    <div class="qa-ans-table-body row col-12" *ngIf="usecase">
        <div class="with-checkbox-data col-3">
            <div class="kr-sg-checkbox p-0 m-0 d-none">
                <input id="checkbox-1" class="checkbox-custom" type="checkbox">
                <label for="checkbox-1" class="checkbox-custom-label"></label>
            </div>
            <div class="label-info-qa-ans d-none">
                <div class="primary-text d-none">{{"AGENTASSIST.CONTACT_AGENT" | translate}}</div>
                <div class="qa-text">{{usecase.usecaseName}}</div>
                <span class="more-info">{{"COUNT_MORE" | translate}}</span>
            </div>

            <div class="w-100" [ngStyle]="{'pointer-events': workflowService.appState == 'published'?'none': 'unset'}" [matMenuTriggerFor]="usecaseUpdate" #ucNameUpdateTrigger>
                <div class="titles-data p-0" [id]="'dropdownMenu'+i">
                    <div class="primary-title">{{usecase.usecaseName}}</div>
                </div>
                <mat-menu #usecaseUpdate="matMenu" class="mat-menu-table-edit p-0">
                    <ng-template matMenuContent>
                        <div class="usecases-table-edit-name-content">
                            <div class="kr-sg-input-text mb-3" (click)="$event.stopPropagation()">
                                <div class="label-text"> {{ "USECASES.UC_NAME" | translate }}</div>
                                <input type="text" id="usecaseName" [ngModel]="usecase.usecaseName" #usecaseName='ngModel' #inp [placeholder]="'PLACEHOLDERS.PLS_ENTER' | translate" name="usecaseName" required autocomplete="off" class="input-text">
                                <div class="error-msg" *ngIf="usecaseName.invalid && usecaseName.touched">{{ 'PLACEHOLDERS.PLS_ENTER' | translate }}</div>
                            </div>
                            <button class="kr-sg-button-primary btn_lg mr-2" [disabled]="usecaseName.invalid || usecaseName.pristine" type="submit" (click)="updateQues(usecaseName.value, usecase)">{{ "USECASES.UPDATE" | translate }}</button>
                            <button class="kr-sg-button-secondary btn_lg" (click)="close();" type="button">{{ "USECASES.CANCEL" | translate }}</button>
                        </div>
                        <!-- <app-uc-table-edit-name [ucEdit]="usecase" (closeMenu)="close(i)"></app-uc-table-edit-name> -->
                    </ng-template>
                </mat-menu>
            </div>
        </div>
        <div class="col-3 content-data" [matMenuTriggerFor]="catEdit" [ngStyle]="{'pointer-events': workflowService.appState == 'published'?'none': 'unset'}" (menuOpened)="selectedCategory = usecase.category; selectedPallete = ''">
            <div class="secondary-title" [ngStyle]="{'color': usecase.categoryColor}">{{usecase.category || "USECASES.NO_CATEGORY" | translate }}</div>
            <mat-menu #catEdit class="uc-category-menu">
                <ng-template matMenuContent>
                    <div class="kr-sg-dropdowns mb-3" (click)="$event.stopPropagation()">
                        <div class="label-text">{{ "USECASES.CATEGORY" | translate }}</div>
                        <div class="inp-block">
                            <input type="text" (keydown.enter)="createCategory($event)" class="form-control" [placeholder]="'PLACEHOLDERS.TYPE_ENTER' | translate" maxlength="30" [matAutocomplete]="auto" #aComp #autoCompleteInput="matAutocompleteTrigger">
                            <div class="inp-stamp" [ngStyle]="{'background-color': selectedPallete}"></div>
                        </div>
                        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onCategory($event?.option.value)">
                            <mat-option *ngFor="let category of agentAssistService?.categories$ | async | filter: [aComp.value, 'category']" [value]="category.category">
                                <div>{{category.category}}</div>
                                <div class="stamp" [ngStyle]="{'background-color': category.colorCode}"></div>
                            </mat-option>
                        </mat-autocomplete>
                    </div>
                    <button class="kr-sg-button-primary btn_lg mr-2" type="submit" [disabled]="!aComp.value" (click)="updateCategory(usecase)">{{ "USECASES.UPDATE" | translate }}</button>
                    <button class="kr-sg-button-secondary btn_lg" type="button">{{ "USECASES.CANCEL" | translate }}</button>
                </ng-template>
            </mat-menu>

        </div>
        <div class="col-3 content-data">
            <div class="utterances-data row m-0 align-items-center" (click)="openUserUtterance(usecase, i)" [id]="'dropdownUtterances'+i">
                <div class="ut-title" *ngIf="usecase.utterances?.alternates.length == 0">{{ "USECASES.NO_UTTERANCES" | translate }}</div>
                <div class="ut-title" *ngIf="usecase.utterances?.alternates.length > 0" title="{{usecase.utterances?.alternates[0].text}}" [ngClass]="{'text-truncate':usecase.utterances?.alternates.length}">{{usecase.utterances?.alternates[0].text}}</div>
                <div class="more-link" *ngIf="usecase.utterances?.alternates.length-1 > 0">
                    +{{usecase.utterances?.alternates.length - 1}} {{ "USECASES.MORE" | translate }}
                </div>
            </div>
        </div>

        <!-- <div class="category-title col-3">General Information</div> -->
        <div class="chats-res col-2" (click)="openConfigSlider(usecase)">
            <span class="table-icon" *ngIf="false">
                <img src="assets/images/usecases/setting.svg">
                <span class="blue-text">{{ "USECASES.CONFIGURE" | translate }}</span>
            </span>
            <span class="table-icon" *ngIf="true">
                <i class="blue-text">{{ "USECASES.VIEW_RESPONSE" | translate }}</i>
            </span>
        </div>
        <div class="status-data col-1">
            <!-- <div class="status-clock" [container]="'body'" placement="bottom-center" ngbTooltip="In Development">
                <img src="assets/icons/status-clock.svg">
            </div> -->
            <div class="status-clock" *ngIf="usecase.state == 'configured'" [container]="'body'" placement="bottom-center" ngbTooltip="{{ 'USECASES.IN_DEV' | translate }}">
                <img src="assets/icons/status-clock.svg">
            </div>
            <div class="status-clock" *ngIf="usecase.state == 'published'" [container]="'body'" placement="bottom-center" ngbTooltip="{{ 'USECASES.PUB' | translate }}">
                <img src="assets/icons/published.svg">
            </div>
            <div class="kr-sg-dropdowns elipse-action-dropdown" ngbDropdown [placement]="'bottom-right'">
                <div class="dropdown dropdown-open">
                    <div class="edit-elipse-btn" ngbDropdownToggle>
                        <img src="assets/icons/overflow-black.svg" style="vertical-align: text-bottom;">
                    </div>
                    <ul class="dropdown-menu content-menu" role="menu" aria-labelledby="menu1" ngbDropdownMenu>
                        <li (click)="openConfigSlider(usecase)">
                            <a><img src="assets/icons/edit-black.svg">{{ "USECASES.EDIT" | translate }}</a>
                        </li>
                        <li *ngIf="workflowService.appState == 'configured'" (click)="ucDelete(usecase)">
                            <a><img src="assets/icons/delete-black.svg">{{ "USECASES.DELETE" | translate }}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</ng-template>


<ng-template #ucGroupByTemplate let-category='category' let-isCategory='isCategory'>
    <mat-expansion-panel [hidden]="!category.dialogCount" *ngIf="isCategory" (opened)='expandCat(category)'>
        <mat-expansion-panel-header>
            <div class="row m-0 col-12 p-0 align-items-center row_data" *ngIf="isCategory">
                <div class="col-9 left-sec d-flex p-0">
                    <div class="kr-sg-checkbox m-0 p-0 d-none">
                        <input [id]="'checkbox-' + category.category" class="checkbox-custom" type="checkbox">
                        <label [for]="'checkbox-' + category.category" class="checkbox-custom-label"></label>
                    </div>
                    <div class="indication-color" [ngStyle]="{'background': category.colorCode}"></div>
                    <div class="m-title">{{category.category}}</div>
                </div>
                <div class="col-3 get-time-stamp text-center">{{category.dialogCount}} {{category.dialogCount > 1?'Conversations':'Conversation'}}</div>
            </div>
        </mat-expansion-panel-header>
        <!-- <div *ngIf="ucMainServ.tabActive == 'faq'">
            <div class="loading" *ngIf="isLoading">
                <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
                <span class="wait-message">Loading ...</span>
            </div>
            <ng-container *ngFor="let usecase of usecases; let i = index">
                <ng-container *ngTemplateOutlet="usecaseRowTemplate; context: {usecase:usecase, i:i}"></ng-container>
            </ng-container>
        </div> -->
        <div>
            <div class="loading" *ngIf="category.isLoading">
                <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
                <span class="wait-message">{{"CONVERSATIONAL_LOGS.LOADING" | translate}}</span>
            </div>
            <ng-container *ngFor="let usecase of category.usecases; let i = index">
                <ng-container *ngTemplateOutlet="usecaseRowTemplate; context: {usecase:usecase, i:i}"></ng-container>
            </ng-container>
        </div>
    </mat-expansion-panel>


    <mat-expansion-panel (opened)='expandState(category)' *ngIf="!isCategory">
        <mat-expansion-panel-header>
            <div class="row m-0 col-12 p-0 align-items-center row_data">
                <div class="col-9 left-sec d-flex p-0">
                    <div class="kr-sg-checkbox m-0 p-0 d-none">
                        <input [id]="'checkbox-' + category.id" class="checkbox-custom" type="checkbox">
                        <label [for]="'checkbox-' + category.id" class="checkbox-custom-label"></label>
                    </div>
                    <div class="state-icon">
                        <img [src]="category.imgSrc">
                    </div>
                    <div class="m-title">{{category.title}}</div>
                </div>
            </div>
        </mat-expansion-panel-header>
        <div>
            <div class="loading" *ngIf="category.isLoading">
                <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
                <span class="wait-message">{{"CONVERSATIONAL_LOGS.LOADING" | translate}}</span>
            </div>
            <ng-container *ngFor="let usecase of category.usecases; let i = index">
                <ng-container *ngTemplateOutlet="usecaseRowTemplate; context: {usecase:usecase, i:i}"></ng-container>
            </ng-container>
            <div class="empty-message" *ngIf="!category.isLoading && category.usecases.length == 0">
                {{'NO_RESULTS' | translate}}
            </div>
        </div>
    </mat-expansion-panel>
</ng-template>

<app-slider-component id="configSlider" #configSlider='app-slider'>
    <app-config-conversation *ngIf="showConfigSlider" (closed)="closeSlider($event)" [inputData]="selectedUsecase"></app-config-conversation>
</app-slider-component>
<app-slider-component id="userUtterances" #userUtterancesSlider='app-slider'>
    <app-user-utterances *ngIf="showUserUtterancesSlider" [inputData]="selectedUsecase" (closed)="closeSlider($event)"></app-user-utterances>
</app-slider-component>