//# sourceMappingURL=socket.io.min.js.map

var agentLogo = 'PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTMiIHZpZXdCb3g9IjAgMCAxOSAxMyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEuMDMxMTIgNS4xNzU3OEMxLjMwOCA1LjE3NTI0IDEuNTczNjkgNS4yODQxOSAxLjc2OTQ4IDUuNDc4NTNDMS45NjUyNiA1LjY3Mjg3IDIuMDc1MDEgNS45MzY2IDIuMDc0NDcgNi4yMTE0NEMyLjA3NDQ3IDYuNzgyMyAxLjYwODI2IDcuMjQ1MDggMS4wMzMxNiA3LjI0NTA4QzAuNDYxMjQ2IDcuMjQwNjMgLTEuNTM4NTNlLTA1IDYuNzc5MTYgMi4xMzcyOWUtMDYgNi4yMTE0NEMtMC4wMDExNDQ0OCA1LjY0MzcyIDAuNDU5MjExIDUuMTgxMzQgMS4wMzExMiA1LjE3NTc4WiIgZmlsbD0iIzAwOURBQiIvPgo8cGF0aCBkPSJNMTcuNzE1MSA1LjE3NTc4QzE3Ljk5MiA1LjE3NTI0IDE4LjI1NzcgNS4yODQxOSAxOC40NTM1IDUuNDc4NTNDMTguNjQ5MyA1LjY3Mjg3IDE4Ljc1OSA1LjkzNjYgMTguNzU4NSA2LjIxMTQ0QzE4Ljc1ODUgNi43ODIzIDE4LjI5MjMgNy4yNDUwOCAxNy43MTcyIDcuMjQ1MDhDMTcuNDQwNyA3LjI0NTYxIDE3LjE3NTMgNy4xMzY5NSAxNi45Nzk1IDYuOTQzMDVDMTYuNzgzOCA2Ljc0OTE0IDE2LjY3MzggNi40ODU5MyAxNi42NzM4IDYuMjExNDRDMTYuNjczMyA1LjkzNjk1IDE2Ljc4MjggNS42NzM1MiAxNi45NzgxIDUuNDc5MjRDMTcuMTczNCA1LjI4NDk2IDE3LjQzODYgNS4xNzU3OCAxNy43MTUxIDUuMTc1NzhaIiBmaWxsPSIjMDA5REFCIi8+CjxwYXRoIGQ9Ik01LjIwMjQ0IDMuMTA1NDdDNS43Nzg2NyAzLjEwNTQ3IDYuMjQ1NzkgMy41NjkxNSA2LjI0NTc5IDQuMTQxMTNWOC4yNzk3MUM2LjI0NTc5IDguODUxNjkgNS43Nzg2NyA5LjMxNTM3IDUuMjAyNDQgOS4zMTUzN0M0LjkyNTkyIDkuMzE1MzcgNC42NjA3NSA5LjIwNjE5IDQuNDY1NDEgOS4wMTE5MUM0LjI3MDA2IDguODE3NjMgNC4xNjA1OSA4LjU1NDIgNC4xNjExMyA4LjI3OTcxVjQuMTQxMTNDNC4xNjA1OSAzLjg2NjY0IDQuMjcwMDYgMy42MDMyMSA0LjQ2NTQxIDMuNDA4OTNDNC42NjA3NSAzLjIxNDY1IDQuOTI1OTIgMy4xMDU0NyA1LjIwMjQ0IDMuMTA1NDdWMy4xMDU0N1oiIGZpbGw9IiMwMDlEQUIiLz4KPHJlY3QgeD0iMTIuNTAyIiB5PSIzLjEwNTQ3IiB3aWR0aD0iMi4wODQ2NSIgaGVpZ2h0PSI2LjIwOTkiIHJ4PSIxLjA0MjMzIiBmaWxsPSIjMDA5REFCIi8+CjxwYXRoIGQ9Ik05LjM3NDQgMEM5LjY1MDkzIC01LjI1NTk2ZS0wNyA5LjkxNjEgMC4xMDkxNzggMTAuMTExNCAwLjMwMzQ1OUMxMC4zMDY4IDAuNDk3NzQxIDEwLjQxNjIgMC43NjExNyAxMC40MTU3IDEuMDM1NjZWMTEuMzg0MUMxMC40MTYyIDExLjY1ODYgMTAuMzA2OCAxMS45MjIxIDEwLjExMTQgMTIuMTE2M0M5LjkxNjEgMTIuMzEwNiA5LjY1MDkzIDEyLjQxOTggOS4zNzQ0IDEyLjQxOThDOC43OTgxOCAxMi40MTk4IDguMzMxMDUgMTEuOTU2MSA4LjMzMTA1IDExLjM4NDFWMS4wMzU2NkM4LjMzMTA1IDAuNDYzNjggOC43OTgxOCAwIDkuMzc0NCAwWiIgZmlsbD0iIzAwOURBQiIvPgo8L3N2Zz4K';
var closeImage = 'PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB2aWV3Qm94PSIwIDAgOCA4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNNC41MzAyNyA0LjAwMDA3TDcuNjQwMTcgMC44OTAxNjVDNy43ODY2MSAwLjc0MzcxOCA3Ljc4NjYxIDAuNTA2MjgxIDcuNjQwMTcgMC4zNTk4MzVDNy40OTM3MiAwLjIxMzM4OCA3LjI1NjI4IDAuMjEzMzg4IDcuMTA5ODQgMC4zNTk4MzVMMy45OTk5MyAzLjQ2OTc1TDAuODkwMTY2IDAuMzYwMTFDMC43NDM3MTYgMC4yMTM2NjcgMC41MDYyNzkgMC4yMTM2NzIgMC4zNTk4MzYgMC4zNjAxMjFDMC4yMTMzOTIgMC41MDY1NzEgMC4yMTMzOTcgMC43NDQwMDggMC4zNTk4NDcgMC44OTA0NTFMMy40Njk2IDQuMDAwMDhMMC4zNTk4MzUgNy4xMDk4NUMwLjIxMzM4OCA3LjI1NjI5IDAuMjEzMzg4IDcuNDkzNzMgMC4zNTk4MzUgNy42NDAxOEMwLjUwNjI4MiA3Ljc4NjYyIDAuNzQzNzE5IDcuNzg2NjIgMC44OTAxNjUgNy42NDAxOEwzLjk5OTk0IDQuNTMwNEw3LjEwOTg1IDcuNjQwMThDNy4yNTYzIDcuNzg2NjIgNy40OTM3MyA3Ljc4NjYyIDcuNjQwMTggNy42NDAxN0M3Ljc4NjYyIDcuNDkzNzIgNy43ODY2MiA3LjI1NjI4IDcuNjQwMTcgNy4xMDk4NEw0LjUzMDI3IDQuMDAwMDdaIiBmaWxsPSIjMjAyMTI0Ii8+Cjwvc3ZnPgo=';
var userImage = 'PHN2ZyB3aWR0aD0iMzciIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE4LjUgMEMxNC45Mzk5IDAgMTEuNDU5OCAxLjA1NTY4IDguNDk5NzQgMy4wMzM1NUM1LjUzOTY2IDUuMDExNDEgMy4yMzI1NSA3LjgyMjYzIDEuODcwMTggMTEuMTExN0MwLjUwNzc5OSAxNC40MDA4IDAuMTUxMzM5IDE4LjAyIDAuODQ1ODczIDIxLjUxMTZDMS41NDA0MSAyNS4wMDMzIDMuMjU0NzQgMjguMjEwNiA1Ljc3MjA5IDMwLjcyNzlDOC4yODk0MyAzMy4yNDUzIDExLjQ5NjcgMzQuOTU5NiAxNC45ODg0IDM1LjY1NDFDMTguNDggMzYuMzQ4NyAyMi4wOTkyIDM1Ljk5MjIgMjUuMzg4MyAzNC42Mjk4QzI4LjY3NzQgMzMuMjY3NSAzMS40ODg2IDMwLjk2MDMgMzMuNDY2NSAyOC4wMDAzQzM1LjQ0NDMgMjUuMDQwMiAzNi41IDIxLjU2MDEgMzYuNSAxOEMzNi41IDEzLjIyNjEgMzQuNjAzNiA4LjY0NzczIDMxLjIyNzkgNS4yNzIwOEMyNy44NTIzIDEuODk2NDIgMjMuMjczOSAwIDE4LjUgMFYwWiIgZmlsbD0iI0RDRERGNyIvPgo8cGF0aCBkPSJNMjUuNjM5NCAxNS4yMzM0QzI1LjYzOTQgMTYuNjQ1NSAyNS4yMjA3IDE4LjAyNTkgMjQuNDM2MSAxOS4yMDAxQzIzLjY1MTYgMjAuMzc0MiAyMi41MzY1IDIxLjI4OTMgMjEuMjMxOSAyMS44Mjk3QzE5LjkyNzMgMjIuMzcwMSAxOC40OTE4IDIyLjUxMTQgMTcuMTA2OCAyMi4yMzZDMTUuNzIxOCAyMS45NjA1IDE0LjQ0OTcgMjEuMjgwNSAxMy40NTEyIDIwLjI4MkMxMi40NTI3IDE5LjI4MzUgMTEuNzcyNyAxOC4wMTEzIDExLjQ5NzIgMTYuNjI2M0MxMS4yMjE3IDE1LjI0MTQgMTEuMzYzMSAxMy44MDU4IDExLjkwMzUgMTIuNTAxMkMxMi40NDM5IDExLjE5NjYgMTMuMzU5IDEwLjA4MTUgMTQuNTMzMSA5LjI5NzAxQzE1LjcwNzIgOC41MTI0OSAxNy4wODc2IDguMDkzNzUgMTguNDk5NyA4LjA5Mzc1QzE5LjQzNzMgOC4wOTM2MyAyMC4zNjU4IDguMjc4MjIgMjEuMjMyMSA4LjYzNjk5QzIyLjA5ODQgOC45OTU3NSAyMi44ODU1IDkuNTIxNjUgMjMuNTQ4NSAxMC4xODQ3QzI0LjIxMTUgMTAuODQ3NyAyNC43Mzc0IDExLjYzNDggMjUuMDk2MiAxMi41MDExQzI1LjQ1NDkgMTMuMzY3MyAyNS42Mzk1IDE0LjI5NTggMjUuNjM5NCAxNS4yMzM0WiIgZmlsbD0iIzg1ODhEOSIvPgo8cGF0aCBkPSJNMTguNSAyNS40NDE3QzE2LjE2NzcgMjUuNDI2OCAxMy44NjI3IDI1Ljk0NDIgMTEuNzYwNSAyNi45NTQ1QzkuNjU4MzEgMjcuOTY0OCA3LjgxNDMzIDI5LjQ0MTQgNi4zNjg5IDMxLjI3MTlDOS42NzY3IDM0LjMxMzUgMTQuMDA2NCAzNi4wMDE1IDE4LjUgMzYuMDAxNUMyMi45OTM2IDM2LjAwMTUgMjcuMzIzMyAzNC4zMTM1IDMwLjYzMTEgMzEuMjcxOUMyOS4xODU3IDI5LjQ0MTQgMjcuMzQxNyAyNy45NjQ4IDI1LjIzOTUgMjYuOTU0NUMyMy4xMzczIDI1Ljk0NDIgMjAuODMyMyAyNS40MjY4IDE4LjUgMjUuNDQxN1oiIGZpbGw9IiM4NTg4RDkiLz4KPC9zdmc+Cg==';
var _agentAsisstSocket = null;
var _agentAssistComponents = {};
var agentAssistSocketUrl ="https://smartassist.kore.ai"
var btnCount = 0;
var _userTranscript = false;

function koreGenerateUUID() {
        console.info("generating UUID");
        var d = new Date().getTime();
        if (window.performance && typeof window.performance.now === "function") {
            d += performance.now(); //use high-precision timer if available
        }
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = (d + Math.random() * 16) % 16 | 0;
            d = Math.floor(d / 16);
            return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
        return uuid;
    }
window._agentAssisteventListenerAdded = false;
window.AgentAssist = function AgentAssist(containerId, _conversationId, _userId, _botId) {
    _userTranscript = false;
    _conversationId = sanitize(_conversationId);
    console.log("AgentAssist >>> no of agent assist instances", _agentAssistComponents);
    if (!window._agentAssisteventListenerAdded) {
        btnInit();
    }
    var _agentAssistDataObj = this;
    var publicAPIs = {};

    publicAPIs.botId = _agentAssistDataObj.botId = _botId;
    publicAPIs.userId = _agentAssistDataObj.userId = _userId;
    publicAPIs.containerId = _agentAssistDataObj.containerId = containerId;
    publicAPIs._conversationId = _agentAssistDataObj.conversationId = _conversationId;

    if (!_agentAssistComponents[_agentAssistDataObj.conversationId]) {
        _agentAssistComponents[_agentAssistDataObj.conversationId] = _agentAssistDataObj;
    } else {
        _agentAssistDataObj = _agentAssistComponents[_agentAssistDataObj.conversationId];
    }
    var korecookie = localStorage.getItem("korecom");
        var uuid = (korecookie) || koreGenerateUUID();
        console.log(uuid);
    console.log("AgentAssist >>> uuId", _agentAssistDataObj.userId);
    if (_agentAsisstSocket === null) {
        _agentAsisstSocket = io(agentAssistSocketUrl +"/koreagentassist",  {
           "path" :"/agentassist/api/v1/chat/", 'query': 'userId=' + uuid + '&orgId=o-da05dbea-6573-5399-ba58-22035a3122f3',transports : ['websocket', 'polling', 'flashsocket'] 
        });
        _agentAsisstSocket.on("connect", () => {
            console.log("AgentAssist >>> socket connected")
        });
        _agentAsisstSocket.on('agent_assist_response', (data) => {
            data.conversationId = sanitize(data.conversationId);
            processAgentAssistResponse(data, data.conversationId, _botId, _agentAssistDataObj.userId);
        })
        _agentAsisstSocket.on('user_message', (data) => {
            data.conversationId = sanitize(data.conversationId);
            processUserMessage(data, data.conversationId, _botId, _agentAssistDataObj.userId);
        })
    }
    console.log("AgentAssist >>> creating container for user", _agentAssistDataObj.userId)
    createAgentAssistContainer(_agentAssistDataObj.containerId, _agentAssistDataObj.conversationId, _agentAssistDataObj.botId, _agentAssistDataObj.userId);

    
    //console.log("AgentAssist >>> welcomeRequestSent", _agentAssistDataObj.conversationId, _agentAssistComponents[_agentAssistDataObj.conversationId], true !== _agentAssistComponents[_agentAssistDataObj.conversationId].welcomeRequestSent)
    /*if (_agentAssistComponents[_agentAssistDataObj.conversationId].welcomeRequestSent !== true) {
        var welcome_message_request = {
            'waitTime' : 2000,
            'userName' : 'test',
            'id' : _agentAssistDataObj.conversationId
        }
        console.log("AgentAssist >>> sending welcome_message_request")
        _agentAsisstSocket.emit('welcome_message_request', welcome_message_request);
        _agentAssistComponents[_agentAssistDataObj.conversationId].welcomeRequestSent = true;
    } else {
        setTimeout(() => {
            var dataArray = _agentAssistComponents[_agentAssistDataObj.conversationId].data;
            console.log("AgentAssist >>> rendering data", dataArray, _agentAssistDataObj.conversationId, _agentAssistDataObj.botId, _agentAssistDataObj.userId)
            if (dataArray && dataArray.length > 0) {
                for (var i = 0; i < dataArray.length; i++) {
                    var data = dataArray[i];
                    processData(data, _agentAssistDataObj.conversationId, _agentAssistDataObj.botId, _agentAssistDataObj.userId);
                }
            }
        }, 100);
    }*/
    var welcome_message_request = {
        'waitTime' : 2000,
        'userName' : 'test',
        'id' : deSanitize(_agentAssistDataObj.conversationId)
    }
    console.log("AgentAssist >>> sending welcome_message_request")
    _agentAsisstSocket.emit('welcome_message_request', welcome_message_request);


    function processAgentAssistResponse(data, convId, botId, userId) {
        console.log("AgentAssist >>> agentassist_response:", data, userId);
        processData(data, data.conversationId, botId, userId);
        scrollToBottom(convId);
    }
    function processData(data, convId, botId, userId) {
        if (data.type === 'button' && data.buttons && data.buttons.length > 0) {
            addButtons(data, convId, botId, userId);
        } else if (data.type === 'intent') {
            addIntent(data);
        }
    }
    function addIntent(data) {
        var iHtml = `
        
        <div class="added-text-info">
            <img src="data:image/svg+xml;base64,${agentLogo}">
            <span class="agent-asist-text">Customer may be interested in this</span>
        </div>
        
        `
        iHtml += `
                <div  class="intent-text mb-3">
                    <div  class="title">Automation Suggestion</div>
                    <div  class="close-intent">
                    <img src="data:image/svg+xml;base64,${closeImage}">
                    </div>
                    <div  class="intent-info-text">"${data.value}"</div>
                    <div  class="d-flex align-items-center justify-content-between">
                        <div  class="intent-tag col-9 p-0">${data.intentName}</div>
                        <div data-conv-id="${data.conversationId}" data-bot-id="${_botId}" data-intent-name="${data.intentName}" data-agent-id=${data.agentId} data-run="true" class="run" >Run</div>
                    </div>
                </div>
        
        `;
        var convId = data.conversationId;
        var btnList = document.getElementById('botlist-' + convId);
        if (btnList) {
            btnList.innerHTML += iHtml;
        }
    }
    function btnInit() {
        document.addEventListener("click", (evt) => {
            var target = evt.target;
            if (target.id === 'userTranscript') {
                _userTranscript=  target.checked;
                return;
            }
           // console.log("inside click event of ", target);
            var sendButton = target.dataset.asSend;
            var copyButton = target.dataset.asCopy;
            var convId = target.dataset.convId;
            var btnId = target.dataset.btnId;
            var runButton = target.dataset.run;
            console.log(`runButton, ${runButton}, sendButton ${sendButton}, copyButton ${copyButton}, convId ${convId}, btnId ${btnId}`);
            if (runButton) {
                AgentAssist_run_click(evt);
                return;
            }
            if (convId) {
            	var convElements = document.querySelectorAll(`[data-conv-id="${convId}"`);
                if (convElements && convElements.length > 0) {
                    for (var i = 0; i < convElements.length; i++) {
                        var convEl = convElements[i];
                        var elConvId = convEl.dataset.convId;
                        var elBtnId = convEl.dataset.btnId;
                        if (elConvId === convId && elBtnId === btnId) {
                            var textVal = convEl.dataset.textValue;
                            if (textVal) {
                                console.log(`textVal=${textVal}`);
                                var astObj;
                                var pubSub;
                                if (window._koreSessions) {
                                    astObj =  window._koreSessions[convId];
                                    pubSub = astObj.getPubSub();
                                }
                                if (!astObj || !astObj.getPubSub) {
                                    pubSub = AgentAssistPubSub;
                                }
                                pubSub.publish('agent_assist_send_msg_user', {value : textVal })
                            }
                        }
                    }
                }
            }
        })

        document.addEventListener("keydown", (evt) => {
            var target = evt.target;
            var agentAssistInput = target.dataset.agentAssistInput;
            if (agentAssistInput) {
                AgentAssist_input_keydown(evt);
            }
        })
        window._agentAssisteventListenerAdded = true;
    }
    function processUserMessage(data, _conversationId, botId, user) {
        if (!_userTranscript) {
            return;
        }
        console.log("AgentAssist >>> processUserMessage", data, _conversationId, botId, user);
        var mainText = data.value;
        if (!mainText && mainText.length === 0) {
            return;
        }
        var convId = data.conversationId;
        var btnList = document.getElementById('botlist-' + convId);
        if (!btnList) {
            console.log(`AgentAssist >>> botlist-${convId} not found, creating it`)
            createAgentAssistContainer(containerId, convId, botId, userId);
            btnList = document.getElementById('botlist-' + convId);
        }
        
            //clearNode(btnList);
            var btnListHtml = `
                <div class="logo-with-desc-text right-align">
                    <img src="data:image/svg+xml;base64,${userImage}" style="width:19px;height:13px">
                    <span class="text_info">${mainText}</span>
                </div>`;
            btnList.innerHTML += btnListHtml;
    }
    
    function clearNode(node) {
        while (node.firstChild) {
            node.removeChild(node.lastChild);
        }
    }
    function createAgentAssistContainer(containerId, conversationId, botId, userId) {
        console.log("AgentAssist >>> finding container ", containerId);
        console.log("AgentAssist >>> userId in createAgentAssistContainer", containerId, conversationId, userId, botId)
        var container = document.getElementById(containerId);
        if (container) {
            console.log("AgentAssist >>> found container", container);
            var cHtml = `<div class="agent-with-bots">
                <div class="inner-bots-container">
                    <div class="agent-bot-types">
                        <div class="bot-list-accr">
                        <!--
                            <ul class="nav nav-tabs">
                                <li placement="top-center" tooltipclass="tooltip-global-">
                                    <a data-toggle="tab" href="#botlist" class="active">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAuNDkyMjQ5IDYuMDU0MjFlLTA1QzAuNDI2NTg3IDAuMDAxMDczODMgMC4zNjE3NzEgMC4wMTQ4NjkgMC4zMDE1IDAuMDQwNjU4MUMwLjI0MTIyOSAwLjA2NjQ0NzMgMC4xODY2ODQgMC4xMDM3MjUgMC4xNDA5OCAwLjE1MDM2NEMwLjA5NTI3NjEgMC4xOTcwMDMgMC4wNTkzMDc3IDAuMjUyMDg4IDAuMDM1MTI4OCAwLjMxMjQ3NkMwLjAxMDk0OTggMC4zNzI4NjMgLTAuMDAwOTY2MiAwLjQzNzM2OSA2LjEyMDY5ZS0wNSAwLjUwMjMxMlY2LjQzNjZWMTAuNTE2NEMtMC4wMDAxMzk1ODMgMTAuNjA0NiAwLjAyMzQ3MzQgMTAuNjkxMSAwLjA2ODQ1NzEgMTAuNzY3MkMwLjExMzQ0MSAxMC44NDMzIDAuMTc4MTYxIDEwLjkwNjEgMC4yNTU5MjEgMTAuOTQ5MUMwLjI1NTkyMSAxMC45NDkxIDAuNzczNDI3IDExLjIyOTUgMS43MjY2MiAxMS40ODgxQzIuNjc5ODIgMTEuNzQ2NyA0LjEwMTExIDEyIDYuMDAwMDYgMTJDNy44OTkwMSAxMiA5LjMyMDMgMTEuNzQ2NyAxMC4yNzM1IDExLjQ4ODFDMTEuMjI2NyAxMS4yMjk1IDExLjc0NDIgMTAuOTQ5MSAxMS43NDQyIDEwLjk0OTFDMTEuODIyIDEwLjkwNjEgMTEuODg2NyAxMC44NDMzIDExLjkzMTcgMTAuNzY3MkMxMS45NzY2IDEwLjY5MTEgMTIuMDAwMyAxMC42MDQ2IDEyLjAwMDEgMTAuNTE2NFY3LjA2NDQyQzEyLjAwMDUgNy4wNTI4MyAxMi4wMDA1IDcuMDQxMjMgMTIuMDAwMSA3LjAyOTY0VjUuOTQyMDhWMC41MDIzMTJDMTIuMDAxMSAwLjQzNjA2OSAxMS45ODg3IDAuMzcwMjkzIDExLjk2MzUgMC4zMDg4ODlDMTEuOTM4NCAwLjI0NzQ4NSAxMS45MDEgMC4xOTE3MDQgMTEuODUzNyAwLjE0NDg1N0MxMS44MDYzIDAuMDk4MDExIDExLjc0OTkgMC4wNjEwNTQxIDExLjY4NzggMC4wMzYxODA2QzExLjYyNTcgMC4wMTEzMDcxIDExLjU1OTIgLTAuMDAwOTc1OTQyIDExLjQ5MjIgNi4wNTQyMWUtMDVDMTEuNDI2NiAwLjAwMTA3Mzc3IDExLjM2MTggMC4wMTQ4Njg4IDExLjMwMTUgMC4wNDA2NTc5QzExLjI0MTIgMC4wNjY0NDcgMTEuMTg2NyAwLjEwMzcyNSAxMS4xNDEgMC4xNTAzNjRDMTEuMDk1MyAwLjE5NzAwMiAxMS4wNTkzIDAuMjUyMDg4IDExLjAzNTEgMC4zMTI0NzZDMTEuMDEwOSAwLjM3Mjg2MyAxMC45OTkgMC40MzczNjkgMTEuMDAwMSAwLjUwMjMxMlYyLjY5MDk3QzkuOTUyNDYgMS4xNDI5NyA4LjE4MjU4IDAuMTA2NTUxIDYuMTc3OCAwLjA0NDQ5MDVDNi4xMjEzMSAwLjAyMTYzMTUgNi4wNjEwNyAwLjAwOTE5MjEzIDYuMDAwMDYgMC4wMDc3ODc0OEMzLjkxOTMyIDAuMDA3Nzg3NDggMi4wNzc0NyAxLjA3MjgyIDEuMDAwMDYgMi42Nzc0NVYwLjUwMjMxMkMxLjAwMTExIDAuNDM2MDY5IDAuOTg4NjkgMC4zNzAyOTMgMC45NjM1NDEgMC4zMDg4ODlDMC45MzgzOTIgMC4yNDc0ODUgMC45MDEwMjYgMC4xOTE3MDQgMC44NTM2NjEgMC4xNDQ4NTdDMC44MDYyOTYgMC4wOTgwMTA4IDAuNzQ5ODk3IDAuMDYxMDU0MSAwLjY4NzgxMyAwLjAzNjE4MDZDMC42MjU3MjkgMC4wMTEzMDcxIDAuNTU5MjI1IC0wLjAwMDk3NjAwOSAwLjQ5MjI0OSA2LjA1NDIxZS0wNVpNNi4wMDAwNiAwLjk5NjgzNkM4Ljc1MjMzIDAuOTk2ODM2IDExLjAwMDEgMy4yMTk5NSAxMS4wMDAxIDUuOTQyMDhWNy4wMjk2NFYxMC4xNzY0QzEwLjg3MjkgMTAuMjM5NyAxMC42OTkzIDEwLjM0NjMgMTAuMDA3OSAxMC41MzM4QzkuMTM4MDcgMTAuNzY5OCA3LjgwOTExIDExLjAxMSA2LjAwMDA2IDExLjAxMUM0LjE5MTAxIDExLjAxMSAyLjg2MjA1IDEwLjc2OTggMS45OTIyNSAxMC41MzM4QzEuMzAwODYgMTAuMzQ2MyAxLjEyNzIxIDEwLjIzOTcgMS4wMDAwNiAxMC4xNzY0VjYuNDcxMzdDMS4wMDA0NyA2LjQ1OTc5IDEuMDAwNDcgNi40NDgxOSAxLjAwMDA2IDYuNDM2NlY1Ljk0MjA4QzEuMDAwMDYgMy4yMTk5NSAzLjI0Nzc5IDAuOTk2ODM2IDYuMDAwMDYgMC45OTY4MzZaTTMuNTAwMDYgNC45NTMwM0MyLjY3NTA2IDQuOTUzMDMgMi4wMDAwNiA1LjYyMDY0IDIuMDAwMDYgNi40MzY2QzIuMDAwMDYgNy4yNTI1NyAyLjY3NTA2IDcuOTIwMTggMy41MDAwNiA3LjkyMDE4SDguNTAwMDZDOS4zMjUwNiA3LjkyMDE4IDEwLjAwMDEgNy4yNTI1NyAxMC4wMDAxIDYuNDM2NkMxMC4wMDAxIDUuNjIwNjQgOS4zMjUwNiA0Ljk1MzAzIDguNTAwMDYgNC45NTMwM0gzLjUwMDA2Wk0zLjQ3NjYyIDUuOTQyMDhDMy43NTI2MiA1Ljk0MjA4IDMuOTc2NjIgNi4xNjM2MyAzLjk3NjYyIDYuNDM2NkMzLjk3NjYyIDYuNzA5NTggMy43NTM2MiA2LjkzMTEzIDMuNDc2NjIgNi45MzExM0MzLjIwMDYyIDYuOTMxMTMgMi45NzY2MiA2LjcwOTU4IDIuOTc2NjIgNi40MzY2QzIuOTc2NjIgNi4xNjM2MyAzLjIwMDYyIDUuOTQyMDggMy40NzY2MiA1Ljk0MjA4Wk04LjUwMDA2IDUuOTQyMDhDOC43NzYwNiA1Ljk0MjA4IDkuMDAwMDYgNi4xNjM2MyA5LjAwMDA2IDYuNDM2NkM5LjAwMDA2IDYuNzA5NTggOC43NzYwNiA2LjkzMTEzIDguNTAwMDYgNi45MzExM0M4LjIyNDA2IDYuOTMxMTMgOC4wMDAwNiA2LjcwOTU4IDguMDAwMDYgNi40MzY2QzguMDAwMDYgNi4xNjM2MyA4LjIyNDA2IDUuOTQyMDggOC41MDAwNiA1Ljk0MjA4WiIgZmlsbD0iIzIwMjEyNCIvPgo8L3N2Zz4K" class="inactive-img">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAuNDkyMjQ5IDYuMDU0MjFlLTA1QzAuNDI2NTg3IDAuMDAxMDczODMgMC4zNjE3NzEgMC4wMTQ4NjkgMC4zMDE1IDAuMDQwNjU4MUMwLjI0MTIyOSAwLjA2NjQ0NzMgMC4xODY2ODQgMC4xMDM3MjUgMC4xNDA5OCAwLjE1MDM2NEMwLjA5NTI3NjEgMC4xOTcwMDMgMC4wNTkzMDc3IDAuMjUyMDg4IDAuMDM1MTI4OCAwLjMxMjQ3NkMwLjAxMDk0OTggMC4zNzI4NjMgLTAuMDAwOTY2MiAwLjQzNzM2OSA2LjEyMDY5ZS0wNSAwLjUwMjMxMlY2LjQzNjZWMTAuNTE2NEMtMC4wMDAxMzk1ODMgMTAuNjA0NiAwLjAyMzQ3MzQgMTAuNjkxMSAwLjA2ODQ1NzEgMTAuNzY3MkMwLjExMzQ0MSAxMC44NDMzIDAuMTc4MTYxIDEwLjkwNjEgMC4yNTU5MjEgMTAuOTQ5MUMwLjI1NTkyMSAxMC45NDkxIDAuNzczNDI3IDExLjIyOTUgMS43MjY2MiAxMS40ODgxQzIuNjc5ODIgMTEuNzQ2NyA0LjEwMTExIDEyIDYuMDAwMDYgMTJDNy44OTkwMSAxMiA5LjMyMDMgMTEuNzQ2NyAxMC4yNzM1IDExLjQ4ODFDMTEuMjI2NyAxMS4yMjk1IDExLjc0NDIgMTAuOTQ5MSAxMS43NDQyIDEwLjk0OTFDMTEuODIyIDEwLjkwNjEgMTEuODg2NyAxMC44NDMzIDExLjkzMTcgMTAuNzY3MkMxMS45NzY2IDEwLjY5MTEgMTIuMDAwMyAxMC42MDQ2IDEyLjAwMDEgMTAuNTE2NFY3LjA2NDQyQzEyLjAwMDUgNy4wNTI4MyAxMi4wMDA1IDcuMDQxMjMgMTIuMDAwMSA3LjAyOTY0VjUuOTQyMDhWMC41MDIzMTJDMTIuMDAxMSAwLjQzNjA2OSAxMS45ODg3IDAuMzcwMjkzIDExLjk2MzUgMC4zMDg4ODlDMTEuOTM4NCAwLjI0NzQ4NSAxMS45MDEgMC4xOTE3MDQgMTEuODUzNyAwLjE0NDg1N0MxMS44MDYzIDAuMDk4MDExIDExLjc0OTkgMC4wNjEwNTQxIDExLjY4NzggMC4wMzYxODA2QzExLjYyNTcgMC4wMTEzMDcxIDExLjU1OTIgLTAuMDAwOTc1OTQyIDExLjQ5MjIgNi4wNTQyMWUtMDVDMTEuNDI2NiAwLjAwMTA3Mzc3IDExLjM2MTggMC4wMTQ4Njg4IDExLjMwMTUgMC4wNDA2NTc5QzExLjI0MTIgMC4wNjY0NDcgMTEuMTg2NyAwLjEwMzcyNSAxMS4xNDEgMC4xNTAzNjRDMTEuMDk1MyAwLjE5NzAwMiAxMS4wNTkzIDAuMjUyMDg4IDExLjAzNTEgMC4zMTI0NzZDMTEuMDEwOSAwLjM3Mjg2MyAxMC45OTkgMC40MzczNjkgMTEuMDAwMSAwLjUwMjMxMlYyLjY5MDk3QzkuOTUyNDYgMS4xNDI5NyA4LjE4MjU4IDAuMTA2NTUxIDYuMTc3OCAwLjA0NDQ5MDVDNi4xMjEzMSAwLjAyMTYzMTUgNi4wNjEwNyAwLjAwOTE5MjEzIDYuMDAwMDYgMC4wMDc3ODc0OEMzLjkxOTMyIDAuMDA3Nzg3NDggMi4wNzc0NyAxLjA3MjgyIDEuMDAwMDYgMi42Nzc0NVYwLjUwMjMxMkMxLjAwMTExIDAuNDM2MDY5IDAuOTg4NjkgMC4zNzAyOTMgMC45NjM1NDEgMC4zMDg4ODlDMC45MzgzOTIgMC4yNDc0ODUgMC45MDEwMjYgMC4xOTE3MDQgMC44NTM2NjEgMC4xNDQ4NTdDMC44MDYyOTYgMC4wOTgwMTA4IDAuNzQ5ODk3IDAuMDYxMDU0MSAwLjY4NzgxMyAwLjAzNjE4MDZDMC42MjU3MjkgMC4wMTEzMDcxIDAuNTU5MjI1IC0wLjAwMDk3NjAwOSAwLjQ5MjI0OSA2LjA1NDIxZS0wNVpNNi4wMDAwNiAwLjk5NjgzNkM4Ljc1MjMzIDAuOTk2ODM2IDExLjAwMDEgMy4yMTk5NSAxMS4wMDAxIDUuOTQyMDhWNy4wMjk2NFYxMC4xNzY0QzEwLjg3MjkgMTAuMjM5NyAxMC42OTkzIDEwLjM0NjMgMTAuMDA3OSAxMC41MzM4QzkuMTM4MDcgMTAuNzY5OCA3LjgwOTExIDExLjAxMSA2LjAwMDA2IDExLjAxMUM0LjE5MTAxIDExLjAxMSAyLjg2MjA1IDEwLjc2OTggMS45OTIyNSAxMC41MzM4QzEuMzAwODYgMTAuMzQ2MyAxLjEyNzIxIDEwLjIzOTcgMS4wMDAwNiAxMC4xNzY0VjYuNDcxMzdDMS4wMDA0NyA2LjQ1OTc5IDEuMDAwNDcgNi40NDgxOSAxLjAwMDA2IDYuNDM2NlY1Ljk0MjA4QzEuMDAwMDYgMy4yMTk5NSAzLjI0Nzc5IDAuOTk2ODM2IDYuMDAwMDYgMC45OTY4MzZaTTMuNTAwMDYgNC45NTMwM0MyLjY3NTA2IDQuOTUzMDMgMi4wMDAwNiA1LjYyMDY0IDIuMDAwMDYgNi40MzY2QzIuMDAwMDYgNy4yNTI1NyAyLjY3NTA2IDcuOTIwMTggMy41MDAwNiA3LjkyMDE4SDguNTAwMDZDOS4zMjUwNiA3LjkyMDE4IDEwLjAwMDEgNy4yNTI1NyAxMC4wMDAxIDYuNDM2NkMxMC4wMDAxIDUuNjIwNjQgOS4zMjUwNiA0Ljk1MzAzIDguNTAwMDYgNC45NTMwM0gzLjUwMDA2Wk0zLjQ3NjYyIDUuOTQyMDhDMy43NTI2MiA1Ljk0MjA4IDMuOTc2NjIgNi4xNjM2MyAzLjk3NjYyIDYuNDM2NkMzLjk3NjYyIDYuNzA5NTggMy43NTM2MiA2LjkzMTEzIDMuNDc2NjIgNi45MzExM0MzLjIwMDYyIDYuOTMxMTMgMi45NzY2MiA2LjcwOTU4IDIuOTc2NjIgNi40MzY2QzIuOTc2NjIgNi4xNjM2MyAzLjIwMDYyIDUuOTQyMDggMy40NzY2MiA1Ljk0MjA4Wk04LjUwMDA2IDUuOTQyMDhDOC43NzYwNiA1Ljk0MjA4IDkuMDAwMDYgNi4xNjM2MyA5LjAwMDA2IDYuNDM2NkM5LjAwMDA2IDYuNzA5NTggOC43NzYwNiA2LjkzMTEzIDguNTAwMDYgNi45MzExM0M4LjIyNDA2IDYuOTMxMTMgOC4wMDAwNiA2LjcwOTU4IDguMDAwMDYgNi40MzY2QzguMDAwMDYgNi4xNjM2MyA4LjIyNDA2IDUuOTQyMDggOC41MDAwNiA1Ljk0MjA4WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cg==" class="active-img">
                                    </a>
                                    <div class="kr-sg-checkbox">
                                        <input id="checkbox-100" type="checkbox"
                                            class="checkbox-custom ng-untouched ng-pristine ng-valid">
                                        <label for="checkbox-100" class="checkbox-custom-label">Auto Suggestion off</label>
                                    </div>
                                    
                                </li>
                                
                                <li placement="top-center" tooltipclass="tooltip-global-" class="">
                                    <a data-toggle="tab" href="#listaccr" class="">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMi41QzEuNzIzODYgMi41IDEuNSAyLjcyMzg2IDEuNSAzQzEuNSAzLjI3NjE0IDEuNzIzODYgMy41IDIgMy41SDE0QzE0LjI3NjEgMy41IDE0LjUgMy4yNzYxNCAxNC41IDNDMTQuNSAyLjcyMzg2IDE0LjI3NjEgMi41IDE0IDIuNUgyWk0yIDcuNUMxLjcyMzg2IDcuNSAxLjUgNy43MjM4NiAxLjUgOEMxLjUgOC4yNzYxNCAxLjcyMzg2IDguNSAyIDguNUgxNEMxNC4yNzYxIDguNSAxNC41IDguMjc2MTQgMTQuNSA4QzE0LjUgNy43MjM4NiAxNC4yNzYxIDcuNSAxNCA3LjVIMlpNMiAxMi41QzEuNzIzODYgMTIuNSAxLjUgMTIuNzIzOSAxLjUgMTNDMS41IDEzLjI3NjEgMS43MjM4NiAxMy41IDIgMTMuNUgxNEMxNC4yNzYxIDEzLjUgMTQuNSAxMy4yNzYxIDE0LjUgMTNDMTQuNSAxMi43MjM5IDE0LjI3NjEgMTIuNSAxNCAxMi41SDJaIiBmaWxsPSIjMjAyMTI0Ii8+Cjwvc3ZnPgo="
                                            class="inactive-img">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMi41QzEuNzIzODYgMi41IDEuNSAyLjcyMzg2IDEuNSAzQzEuNSAzLjI3NjE0IDEuNzIzODYgMy41IDIgMy41SDE0QzE0LjI3NjEgMy41IDE0LjUgMy4yNzYxNCAxNC41IDNDMTQuNSAyLjcyMzg2IDE0LjI3NjEgMi41IDE0IDIuNUgyWk0yIDcuNUMxLjcyMzg2IDcuNSAxLjUgNy43MjM4NiAxLjUgOEMxLjUgOC4yNzYxNCAxLjcyMzg2IDguNSAyIDguNUgxNEMxNC4yNzYxIDguNSAxNC41IDguMjc2MTQgMTQuNSA4QzE0LjUgNy43MjM4NiAxNC4yNzYxIDcuNSAxNCA3LjVIMlpNMiAxMi41QzEuNzIzODYgMTIuNSAxLjUgMTIuNzIzOSAxLjUgMTNDMS41IDEzLjI3NjEgMS43MjM4NiAxMy41IDIgMTMuNUgxNEMxNC4yNzYxIDEzLjUgMTQuNSAxMy4yNzYxIDE0LjUgMTNDMTQuNSAxMi43MjM5IDE0LjI3NjEgMTIuNSAxNCAxMi41SDJaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K"
                                            class="active-img">
                                    </a>
                                </li>
                                
                            </ul>
                            -->
                            Agent Assist
                        </div>
                        <div class="tab-content">
                                            <div id="botlist-${conversationId}" data-conversation-id="${conversationId}" style="overflow-y:scroll;height:80%;padding-right:10px" class="tab-pane fade active show">
                                <!-- all text messages will be appended here -->

                            </div>
                            <!-- <div id="listaccr" class="tab-pane fade">
                                <div id="accordion" class="">
                                    <div class="card-">
                                        <div class="card_header">
                                            <a data-toggle="collapse" href="#collapseOne" class="collapsed card_link col-12">
                                                <div title="" class="title-name col-10 text-truncate">Business Inquiry</div>
                                                <div class="count col-2">1</div>
                                            </a>
                                        </div>
                                        <div id="collapseOne" class="collapse show">
                                            <div class="card-body">
                                                <div class="item-list">
                                                    close account
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-">
                                        <div class="card_header">
                                            <a data-toggle="collapse" href="#collapseOne" class="collapsed card_link col-12">
                                                <div title="" class="title-name col-10 text-truncate">General Information</div>
                                                <div class="count col-2">1</div>
                                            </a>
                                        </div>
                                        <div id="collapseOne" class="collapse show">
                                            <div class="card-body">
                                                <div class="item-list">
                                                    what is my balance
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div> -->
                        </div>
                    </div>
                </div>
                <div class="kr-sg-input-text ask-input-assist">
                     <input tabindex="0" type="text" id="input-${conversationId}" data-user-id="${userId}" data-bot-id="${_botId}" data-conv-id="${conversationId}" 
                         data-agent-assist-input="true" class="input-text" placeholder="Ask Agent Assist..." style="width: calc(100% - 14px);">
                </div>
            </div>`;
            console.log("AgentAssist >>> adding html")
            container.innerHTML = cHtml;
        } else {
            console.log(`AgentAssist >>> container ${containerId} not found`)
        }
    }
    function addButtons(data, _conversationId, botId, userId) {
        console.log("AgentAssist >>> addingButton", data);
        var mainText = data.value;
        if (!mainText && mainText.length === 0) {
            mainText = '';
        }
        var convId = data.conversationId;
        var btnList = document.getElementById('botlist-' + convId);
        if (!btnList) {
            console.log(`AgentAssist >>> botlist-${convId} not found, creating it`)
            createAgentAssistContainer(containerId, convId, botId, userId);
            btnList = document.getElementById('botlist-' + convId);
        }
        
            //clearNode(btnList);
            var btnListHtml = `
                <div class="logo-with-desc-text">
                    <img src="data:image/svg+xml;base64,${agentLogo}">
                    <span class="text_info">${mainText}</span>
                </div>`;
            if (data.buttons && data.buttons.length > 0) {
                for (var i = 0; i < data.buttons.length; i++) {
                    btnCount++;
                    var btn = data.buttons[i];
                    if (btn && btn.type === 'text') {
                        var btnValue = btn.value;
                        btnValue  = btnValue.replaceAll("|", "<br/>")
                        var btnHtml = `
            				<div class="btn-template-data" data-text-value="${btnValue}" data-conv-id="${convId}" 
                                    data-btn-id="${btnCount}">
                                <div class="info-template curser-pointer">"${btnValue}"</div>
            					<div class="overlay-send-copy-">
                                    <div class="send-copy" aura:id="btn-send-${convId}-${btnCount}" id="btn-send-${convId}-${btnCount}" 
                                                data-as-send="true" 
                                                data-conv-id="${convId}" data-btn-id="${btnCount}">SEND</div>
                                    <div class="send-copy" aura:id="btn-copy-${convId}-${btnCount}" id="btn-copy-${convId}-${btnCount}" 
                                                data-as-copy="true" 
                                                data-conv-id="${convId}" data-btn-id="${btnCount}">COPY</div>
                                </div>
                            </div>
                        `;
                        btnListHtml += btnHtml;
                    }
                }
            }
            btnList.innerHTML += btnListHtml;
            
        
    }
    
    function clearNode(node) {
        while (node.firstChild) {
            node.removeChild(node.lastChild);
        }
    }
    function createAgentAssistContainer(containerId, conversationId, botId, userId) {
        console.log("AgentAssist >>> finding container ", containerId);
        console.log("AgentAssist >>> userId in createAgentAssistContainer", containerId, conversationId, userId, botId)
        var container = document.getElementById(containerId);
        if (container) {
            console.log("AgentAssist >>> found container", container);
            var cHtml = `<div class="agent-with-bots">
                <div class="inner-bots-container">
                    <div class="agent-bot-types">
                        <div class="bot-list-accr">
                        <!--
                            <ul class="nav nav-tabs">
                                <li placement="top-center" tooltipclass="tooltip-global-">
                                    <a data-toggle="tab" href="#botlist" class="active">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAuNDkyMjQ5IDYuMDU0MjFlLTA1QzAuNDI2NTg3IDAuMDAxMDczODMgMC4zNjE3NzEgMC4wMTQ4NjkgMC4zMDE1IDAuMDQwNjU4MUMwLjI0MTIyOSAwLjA2NjQ0NzMgMC4xODY2ODQgMC4xMDM3MjUgMC4xNDA5OCAwLjE1MDM2NEMwLjA5NTI3NjEgMC4xOTcwMDMgMC4wNTkzMDc3IDAuMjUyMDg4IDAuMDM1MTI4OCAwLjMxMjQ3NkMwLjAxMDk0OTggMC4zNzI4NjMgLTAuMDAwOTY2MiAwLjQzNzM2OSA2LjEyMDY5ZS0wNSAwLjUwMjMxMlY2LjQzNjZWMTAuNTE2NEMtMC4wMDAxMzk1ODMgMTAuNjA0NiAwLjAyMzQ3MzQgMTAuNjkxMSAwLjA2ODQ1NzEgMTAuNzY3MkMwLjExMzQ0MSAxMC44NDMzIDAuMTc4MTYxIDEwLjkwNjEgMC4yNTU5MjEgMTAuOTQ5MUMwLjI1NTkyMSAxMC45NDkxIDAuNzczNDI3IDExLjIyOTUgMS43MjY2MiAxMS40ODgxQzIuNjc5ODIgMTEuNzQ2NyA0LjEwMTExIDEyIDYuMDAwMDYgMTJDNy44OTkwMSAxMiA5LjMyMDMgMTEuNzQ2NyAxMC4yNzM1IDExLjQ4ODFDMTEuMjI2NyAxMS4yMjk1IDExLjc0NDIgMTAuOTQ5MSAxMS43NDQyIDEwLjk0OTFDMTEuODIyIDEwLjkwNjEgMTEuODg2NyAxMC44NDMzIDExLjkzMTcgMTAuNzY3MkMxMS45NzY2IDEwLjY5MTEgMTIuMDAwMyAxMC42MDQ2IDEyLjAwMDEgMTAuNTE2NFY3LjA2NDQyQzEyLjAwMDUgNy4wNTI4MyAxMi4wMDA1IDcuMDQxMjMgMTIuMDAwMSA3LjAyOTY0VjUuOTQyMDhWMC41MDIzMTJDMTIuMDAxMSAwLjQzNjA2OSAxMS45ODg3IDAuMzcwMjkzIDExLjk2MzUgMC4zMDg4ODlDMTEuOTM4NCAwLjI0NzQ4NSAxMS45MDEgMC4xOTE3MDQgMTEuODUzNyAwLjE0NDg1N0MxMS44MDYzIDAuMDk4MDExIDExLjc0OTkgMC4wNjEwNTQxIDExLjY4NzggMC4wMzYxODA2QzExLjYyNTcgMC4wMTEzMDcxIDExLjU1OTIgLTAuMDAwOTc1OTQyIDExLjQ5MjIgNi4wNTQyMWUtMDVDMTEuNDI2NiAwLjAwMTA3Mzc3IDExLjM2MTggMC4wMTQ4Njg4IDExLjMwMTUgMC4wNDA2NTc5QzExLjI0MTIgMC4wNjY0NDcgMTEuMTg2NyAwLjEwMzcyNSAxMS4xNDEgMC4xNTAzNjRDMTEuMDk1MyAwLjE5NzAwMiAxMS4wNTkzIDAuMjUyMDg4IDExLjAzNTEgMC4zMTI0NzZDMTEuMDEwOSAwLjM3Mjg2MyAxMC45OTkgMC40MzczNjkgMTEuMDAwMSAwLjUwMjMxMlYyLjY5MDk3QzkuOTUyNDYgMS4xNDI5NyA4LjE4MjU4IDAuMTA2NTUxIDYuMTc3OCAwLjA0NDQ5MDVDNi4xMjEzMSAwLjAyMTYzMTUgNi4wNjEwNyAwLjAwOTE5MjEzIDYuMDAwMDYgMC4wMDc3ODc0OEMzLjkxOTMyIDAuMDA3Nzg3NDggMi4wNzc0NyAxLjA3MjgyIDEuMDAwMDYgMi42Nzc0NVYwLjUwMjMxMkMxLjAwMTExIDAuNDM2MDY5IDAuOTg4NjkgMC4zNzAyOTMgMC45NjM1NDEgMC4zMDg4ODlDMC45MzgzOTIgMC4yNDc0ODUgMC45MDEwMjYgMC4xOTE3MDQgMC44NTM2NjEgMC4xNDQ4NTdDMC44MDYyOTYgMC4wOTgwMTA4IDAuNzQ5ODk3IDAuMDYxMDU0MSAwLjY4NzgxMyAwLjAzNjE4MDZDMC42MjU3MjkgMC4wMTEzMDcxIDAuNTU5MjI1IC0wLjAwMDk3NjAwOSAwLjQ5MjI0OSA2LjA1NDIxZS0wNVpNNi4wMDAwNiAwLjk5NjgzNkM4Ljc1MjMzIDAuOTk2ODM2IDExLjAwMDEgMy4yMTk5NSAxMS4wMDAxIDUuOTQyMDhWNy4wMjk2NFYxMC4xNzY0QzEwLjg3MjkgMTAuMjM5NyAxMC42OTkzIDEwLjM0NjMgMTAuMDA3OSAxMC41MzM4QzkuMTM4MDcgMTAuNzY5OCA3LjgwOTExIDExLjAxMSA2LjAwMDA2IDExLjAxMUM0LjE5MTAxIDExLjAxMSAyLjg2MjA1IDEwLjc2OTggMS45OTIyNSAxMC41MzM4QzEuMzAwODYgMTAuMzQ2MyAxLjEyNzIxIDEwLjIzOTcgMS4wMDAwNiAxMC4xNzY0VjYuNDcxMzdDMS4wMDA0NyA2LjQ1OTc5IDEuMDAwNDcgNi40NDgxOSAxLjAwMDA2IDYuNDM2NlY1Ljk0MjA4QzEuMDAwMDYgMy4yMTk5NSAzLjI0Nzc5IDAuOTk2ODM2IDYuMDAwMDYgMC45OTY4MzZaTTMuNTAwMDYgNC45NTMwM0MyLjY3NTA2IDQuOTUzMDMgMi4wMDAwNiA1LjYyMDY0IDIuMDAwMDYgNi40MzY2QzIuMDAwMDYgNy4yNTI1NyAyLjY3NTA2IDcuOTIwMTggMy41MDAwNiA3LjkyMDE4SDguNTAwMDZDOS4zMjUwNiA3LjkyMDE4IDEwLjAwMDEgNy4yNTI1NyAxMC4wMDAxIDYuNDM2NkMxMC4wMDAxIDUuNjIwNjQgOS4zMjUwNiA0Ljk1MzAzIDguNTAwMDYgNC45NTMwM0gzLjUwMDA2Wk0zLjQ3NjYyIDUuOTQyMDhDMy43NTI2MiA1Ljk0MjA4IDMuOTc2NjIgNi4xNjM2MyAzLjk3NjYyIDYuNDM2NkMzLjk3NjYyIDYuNzA5NTggMy43NTM2MiA2LjkzMTEzIDMuNDc2NjIgNi45MzExM0MzLjIwMDYyIDYuOTMxMTMgMi45NzY2MiA2LjcwOTU4IDIuOTc2NjIgNi40MzY2QzIuOTc2NjIgNi4xNjM2MyAzLjIwMDYyIDUuOTQyMDggMy40NzY2MiA1Ljk0MjA4Wk04LjUwMDA2IDUuOTQyMDhDOC43NzYwNiA1Ljk0MjA4IDkuMDAwMDYgNi4xNjM2MyA5LjAwMDA2IDYuNDM2NkM5LjAwMDA2IDYuNzA5NTggOC43NzYwNiA2LjkzMTEzIDguNTAwMDYgNi45MzExM0M4LjIyNDA2IDYuOTMxMTMgOC4wMDAwNiA2LjcwOTU4IDguMDAwMDYgNi40MzY2QzguMDAwMDYgNi4xNjM2MyA4LjIyNDA2IDUuOTQyMDggOC41MDAwNiA1Ljk0MjA4WiIgZmlsbD0iIzIwMjEyNCIvPgo8L3N2Zz4K" class="inactive-img">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAuNDkyMjQ5IDYuMDU0MjFlLTA1QzAuNDI2NTg3IDAuMDAxMDczODMgMC4zNjE3NzEgMC4wMTQ4NjkgMC4zMDE1IDAuMDQwNjU4MUMwLjI0MTIyOSAwLjA2NjQ0NzMgMC4xODY2ODQgMC4xMDM3MjUgMC4xNDA5OCAwLjE1MDM2NEMwLjA5NTI3NjEgMC4xOTcwMDMgMC4wNTkzMDc3IDAuMjUyMDg4IDAuMDM1MTI4OCAwLjMxMjQ3NkMwLjAxMDk0OTggMC4zNzI4NjMgLTAuMDAwOTY2MiAwLjQzNzM2OSA2LjEyMDY5ZS0wNSAwLjUwMjMxMlY2LjQzNjZWMTAuNTE2NEMtMC4wMDAxMzk1ODMgMTAuNjA0NiAwLjAyMzQ3MzQgMTAuNjkxMSAwLjA2ODQ1NzEgMTAuNzY3MkMwLjExMzQ0MSAxMC44NDMzIDAuMTc4MTYxIDEwLjkwNjEgMC4yNTU5MjEgMTAuOTQ5MUMwLjI1NTkyMSAxMC45NDkxIDAuNzczNDI3IDExLjIyOTUgMS43MjY2MiAxMS40ODgxQzIuNjc5ODIgMTEuNzQ2NyA0LjEwMTExIDEyIDYuMDAwMDYgMTJDNy44OTkwMSAxMiA5LjMyMDMgMTEuNzQ2NyAxMC4yNzM1IDExLjQ4ODFDMTEuMjI2NyAxMS4yMjk1IDExLjc0NDIgMTAuOTQ5MSAxMS43NDQyIDEwLjk0OTFDMTEuODIyIDEwLjkwNjEgMTEuODg2NyAxMC44NDMzIDExLjkzMTcgMTAuNzY3MkMxMS45NzY2IDEwLjY5MTEgMTIuMDAwMyAxMC42MDQ2IDEyLjAwMDEgMTAuNTE2NFY3LjA2NDQyQzEyLjAwMDUgNy4wNTI4MyAxMi4wMDA1IDcuMDQxMjMgMTIuMDAwMSA3LjAyOTY0VjUuOTQyMDhWMC41MDIzMTJDMTIuMDAxMSAwLjQzNjA2OSAxMS45ODg3IDAuMzcwMjkzIDExLjk2MzUgMC4zMDg4ODlDMTEuOTM4NCAwLjI0NzQ4NSAxMS45MDEgMC4xOTE3MDQgMTEuODUzNyAwLjE0NDg1N0MxMS44MDYzIDAuMDk4MDExIDExLjc0OTkgMC4wNjEwNTQxIDExLjY4NzggMC4wMzYxODA2QzExLjYyNTcgMC4wMTEzMDcxIDExLjU1OTIgLTAuMDAwOTc1OTQyIDExLjQ5MjIgNi4wNTQyMWUtMDVDMTEuNDI2NiAwLjAwMTA3Mzc3IDExLjM2MTggMC4wMTQ4Njg4IDExLjMwMTUgMC4wNDA2NTc5QzExLjI0MTIgMC4wNjY0NDcgMTEuMTg2NyAwLjEwMzcyNSAxMS4xNDEgMC4xNTAzNjRDMTEuMDk1MyAwLjE5NzAwMiAxMS4wNTkzIDAuMjUyMDg4IDExLjAzNTEgMC4zMTI0NzZDMTEuMDEwOSAwLjM3Mjg2MyAxMC45OTkgMC40MzczNjkgMTEuMDAwMSAwLjUwMjMxMlYyLjY5MDk3QzkuOTUyNDYgMS4xNDI5NyA4LjE4MjU4IDAuMTA2NTUxIDYuMTc3OCAwLjA0NDQ5MDVDNi4xMjEzMSAwLjAyMTYzMTUgNi4wNjEwNyAwLjAwOTE5MjEzIDYuMDAwMDYgMC4wMDc3ODc0OEMzLjkxOTMyIDAuMDA3Nzg3NDggMi4wNzc0NyAxLjA3MjgyIDEuMDAwMDYgMi42Nzc0NVYwLjUwMjMxMkMxLjAwMTExIDAuNDM2MDY5IDAuOTg4NjkgMC4zNzAyOTMgMC45NjM1NDEgMC4zMDg4ODlDMC45MzgzOTIgMC4yNDc0ODUgMC45MDEwMjYgMC4xOTE3MDQgMC44NTM2NjEgMC4xNDQ4NTdDMC44MDYyOTYgMC4wOTgwMTA4IDAuNzQ5ODk3IDAuMDYxMDU0MSAwLjY4NzgxMyAwLjAzNjE4MDZDMC42MjU3MjkgMC4wMTEzMDcxIDAuNTU5MjI1IC0wLjAwMDk3NjAwOSAwLjQ5MjI0OSA2LjA1NDIxZS0wNVpNNi4wMDAwNiAwLjk5NjgzNkM4Ljc1MjMzIDAuOTk2ODM2IDExLjAwMDEgMy4yMTk5NSAxMS4wMDAxIDUuOTQyMDhWNy4wMjk2NFYxMC4xNzY0QzEwLjg3MjkgMTAuMjM5NyAxMC42OTkzIDEwLjM0NjMgMTAuMDA3OSAxMC41MzM4QzkuMTM4MDcgMTAuNzY5OCA3LjgwOTExIDExLjAxMSA2LjAwMDA2IDExLjAxMUM0LjE5MTAxIDExLjAxMSAyLjg2MjA1IDEwLjc2OTggMS45OTIyNSAxMC41MzM4QzEuMzAwODYgMTAuMzQ2MyAxLjEyNzIxIDEwLjIzOTcgMS4wMDAwNiAxMC4xNzY0VjYuNDcxMzdDMS4wMDA0NyA2LjQ1OTc5IDEuMDAwNDcgNi40NDgxOSAxLjAwMDA2IDYuNDM2NlY1Ljk0MjA4QzEuMDAwMDYgMy4yMTk5NSAzLjI0Nzc5IDAuOTk2ODM2IDYuMDAwMDYgMC45OTY4MzZaTTMuNTAwMDYgNC45NTMwM0MyLjY3NTA2IDQuOTUzMDMgMi4wMDAwNiA1LjYyMDY0IDIuMDAwMDYgNi40MzY2QzIuMDAwMDYgNy4yNTI1NyAyLjY3NTA2IDcuOTIwMTggMy41MDAwNiA3LjkyMDE4SDguNTAwMDZDOS4zMjUwNiA3LjkyMDE4IDEwLjAwMDEgNy4yNTI1NyAxMC4wMDAxIDYuNDM2NkMxMC4wMDAxIDUuNjIwNjQgOS4zMjUwNiA0Ljk1MzAzIDguNTAwMDYgNC45NTMwM0gzLjUwMDA2Wk0zLjQ3NjYyIDUuOTQyMDhDMy43NTI2MiA1Ljk0MjA4IDMuOTc2NjIgNi4xNjM2MyAzLjk3NjYyIDYuNDM2NkMzLjk3NjYyIDYuNzA5NTggMy43NTM2MiA2LjkzMTEzIDMuNDc2NjIgNi45MzExM0MzLjIwMDYyIDYuOTMxMTMgMi45NzY2MiA2LjcwOTU4IDIuOTc2NjIgNi40MzY2QzIuOTc2NjIgNi4xNjM2MyAzLjIwMDYyIDUuOTQyMDggMy40NzY2MiA1Ljk0MjA4Wk04LjUwMDA2IDUuOTQyMDhDOC43NzYwNiA1Ljk0MjA4IDkuMDAwMDYgNi4xNjM2MyA5LjAwMDA2IDYuNDM2NkM5LjAwMDA2IDYuNzA5NTggOC43NzYwNiA2LjkzMTEzIDguNTAwMDYgNi45MzExM0M4LjIyNDA2IDYuOTMxMTMgOC4wMDAwNiA2LjcwOTU4IDguMDAwMDYgNi40MzY2QzguMDAwMDYgNi4xNjM2MyA4LjIyNDA2IDUuOTQyMDggOC41MDAwNiA1Ljk0MjA4WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cg==" class="active-img">
                                    </a>
                                    <div class="kr-sg-checkbox">
                                        <input id="checkbox-100" type="checkbox"
                                            class="checkbox-custom ng-untouched ng-pristine ng-valid">
                                        <label for="checkbox-100" class="checkbox-custom-label">Auto Suggestion off</label>
                                    </div>
                                    
                                </li>
                                
                                <li placement="top-center" tooltipclass="tooltip-global-" class="">
                                    <a data-toggle="tab" href="#listaccr" class="">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMi41QzEuNzIzODYgMi41IDEuNSAyLjcyMzg2IDEuNSAzQzEuNSAzLjI3NjE0IDEuNzIzODYgMy41IDIgMy41SDE0QzE0LjI3NjEgMy41IDE0LjUgMy4yNzYxNCAxNC41IDNDMTQuNSAyLjcyMzg2IDE0LjI3NjEgMi41IDE0IDIuNUgyWk0yIDcuNUMxLjcyMzg2IDcuNSAxLjUgNy43MjM4NiAxLjUgOEMxLjUgOC4yNzYxNCAxLjcyMzg2IDguNSAyIDguNUgxNEMxNC4yNzYxIDguNSAxNC41IDguMjc2MTQgMTQuNSA4QzE0LjUgNy43MjM4NiAxNC4yNzYxIDcuNSAxNCA3LjVIMlpNMiAxMi41QzEuNzIzODYgMTIuNSAxLjUgMTIuNzIzOSAxLjUgMTNDMS41IDEzLjI3NjEgMS43MjM4NiAxMy41IDIgMTMuNUgxNEMxNC4yNzYxIDEzLjUgMTQuNSAxMy4yNzYxIDE0LjUgMTNDMTQuNSAxMi43MjM5IDE0LjI3NjEgMTIuNSAxNCAxMi41SDJaIiBmaWxsPSIjMjAyMTI0Ii8+Cjwvc3ZnPgo="
                                            class="inactive-img">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMi41QzEuNzIzODYgMi41IDEuNSAyLjcyMzg2IDEuNSAzQzEuNSAzLjI3NjE0IDEuNzIzODYgMy41IDIgMy41SDE0QzE0LjI3NjEgMy41IDE0LjUgMy4yNzYxNCAxNC41IDNDMTQuNSAyLjcyMzg2IDE0LjI3NjEgMi41IDE0IDIuNUgyWk0yIDcuNUMxLjcyMzg2IDcuNSAxLjUgNy43MjM4NiAxLjUgOEMxLjUgOC4yNzYxNCAxLjcyMzg2IDguNSAyIDguNUgxNEMxNC4yNzYxIDguNSAxNC41IDguMjc2MTQgMTQuNSA4QzE0LjUgNy43MjM4NiAxNC4yNzYxIDcuNSAxNCA3LjVIMlpNMiAxMi41QzEuNzIzODYgMTIuNSAxLjUgMTIuNzIzOSAxLjUgMTNDMS41IDEzLjI3NjEgMS43MjM4NiAxMy41IDIgMTMuNUgxNEMxNC4yNzYxIDEzLjUgMTQuNSAxMy4yNzYxIDE0LjUgMTNDMTQuNSAxMi43MjM5IDE0LjI3NjEgMTIuNSAxNCAxMi41SDJaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K"
                                            class="active-img">
                                    </a>
                                </li>
                                
                            </ul>
                            -->
                            <div class="title-bar">
                                <div class="top-title">
                                    Agent Assist
                                </div>
                                <!-- Rounded switch -->
                                <div class="switch-container" style="left:calc(100% - 264px)">
                                    <div class="user-transcript">
                                        User Transcript
                                    </div>
                                    <div>
                                        <label class="switch">
                                            <input type="checkbox" id="userTranscript">
                                            <span class="slider round"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        
                        <div class="tab-content">
                                            <div id="botlist-${conversationId}" data-conversation-id="${conversationId}" style="overflow-y:scroll;height:95%;padding-right:10px" class="tab-pane fade active show">
                                <!-- all text messages will be appended here -->

                            </div>
                            <!-- <div id="listaccr" class="tab-pane fade">
                                <div id="accordion" class="">
                                    <div class="card-">
                                        <div class="card_header">
                                            <a data-toggle="collapse" href="#collapseOne" class="collapsed card_link col-12">
                                                <div title="" class="title-name col-10 text-truncate">Business Inquiry</div>
                                                <div class="count col-2">1</div>
                                            </a>
                                        </div>
                                        <div id="collapseOne" class="collapse show">
                                            <div class="card-body">
                                                <div class="item-list">
                                                    close account
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-">
                                        <div class="card_header">
                                            <a data-toggle="collapse" href="#collapseOne" class="collapsed card_link col-12">
                                                <div title="" class="title-name col-10 text-truncate">General Information</div>
                                                <div class="count col-2">1</div>
                                            </a>
                                        </div>
                                        <div id="collapseOne" class="collapse show">
                                            <div class="card-body">
                                                <div class="item-list">
                                                    what is my balance
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div> -->
                        </div>
                    </div>
                </div>
                <div class="kr-sg-input-text ask-input-assist">
                     <input tabindex="0" type="text" id="input-${conversationId}" data-user-id="${userId}" data-bot-id="${_botId}" data-conv-id="${conversationId}" 
                         data-agent-assist-input="true" class="input-text" placeholder="Ask Agent Assist..." style="width: calc(100% - 14px);">
                </div>
            </div>`;
            console.log("AgentAssist >>> adding html")
            container.innerHTML = cHtml;
        } else {
            console.log(`AgentAssist >>> container ${containerId} not found`)
        }
    }
    function generateUserId()  {
        console.info("generating user id");
        var d = new Date().getTime();
        if (window.performance && typeof window.performance.now ==="function") {
            d += performance.now(); //use high-precision timer if available
        }
        var uuid = 'u-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = (d + Math.random() * 16) % 16 | 0;
            d = Math.floor(d / 16);
            return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
        console.log("AgentAssist >>> userId", uuid);
        return uuid;
    }

    function generateConversationId() {
        console.info("generating conversation id");
        var d = new Date().getTime();
        if (window.performance && typeof window.performance.now ==="function") {
            d += performance.now(); //use high-precision timer if available
        }
        var convId = 'c-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = (d + Math.random() * 16) % 16 | 0;
            d = Math.floor(d / 16);
            return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
        console.log("AgentAssist >>> conversationId", convId);
        return convId;
    }
    publicAPIs.getPubSub = function() {
        return AgentAssistPubSub;
    }
    publicAPIs.sendText = function(value) {
        AgentAssistPubSub.publish('agent_assist_send_text', {conversationId:_agentAssistDataObj.conversationId, agentId: _agentAssistDataObj.userId, botId: _botId, value : value })
    }
    publicAPIs.runIntent = function(value) {
        AgentAssistPubSub.publish('agent_assist_send_text', {conversationId:_agentAssistDataObj.conversationId, agentId: _agentAssistDataObj.userId, botId: _botId, value : value, intentName:value })
    }

    return publicAPIs;
}
/* ---- Javascript functions used in template htmls are to be coded here ---- */

function AgentAssist_publishValue(convId, val) {
    console.log(`AgentAssist >>> publishing value ${convId}, ${val}`);
    AgentAssistPubSub.publish('agent_assist_text', {'conversationId': convId, 'value': val});
}
function AgentAssist_copyValue(convId, val) {
    console.log(`AgentAssist >>> copying value ${convId} ${val}`);
}
function AgentAssist_input_keydown(e) {
    e = e || window.event;
    //console.log(e.target.dataset.conversationId);
    if (e.keyCode === 13) {
        var convId = e.target.dataset.convId;
        var botId = e.target.dataset.botId;
        var userId = e.target.dataset.userId;
        console.log(`conversationId ${convId}, botId = ${botId}, userId = ${userId}`);
        var value = e.target.value;
        if (value) {
            e.target.value = '';
            AgentAssistPubSub.publish('agent_assist_send_text', {conversationId:convId, agentId: userId, botId: botId, value : value })
        }
    }
}

function AgentAssist_run_click(e) {
    console.log(e.target);
    var convId = e.target.dataset.convId;
    var botId = e.target.dataset.botId;
    var agentId = e.target.dataset.agentId;
    var intentName = e.target.dataset.intentName;
    AgentAssistPubSub.publish('agent_assist_send_text', {conversationId:convId, agentId: agentId, botId: botId, value : intentName, intentName:intentName });
}
function scrollToBottom(convId) {
    setTimeout(() => {
        console.log("convId=", convId);
        var objDiv = document.getElementById(`botlist-${convId}`);
        objDiv.scrollTop = objDiv.scrollHeight - objDiv.clientHeight;
    }, 100);
}
/* -------------------------------------------------------------------------- */



/* ------------------------------ PUBSUB ------------------------------------ */

 (function (root, factory){
    'use strict';

    var AgentAssistPubSub = {};

    if (root.AgentAssistPubSub) {
        AgentAssistPubSub = root.AgentAssistPubSub;
        console.warn("AgentAssistPubSub already loaded, using existing version");
    } else {
        root.AgentAssistPubSub = AgentAssistPubSub;
        factory(AgentAssistPubSub);
    }
    // CommonJS and Node.js module support
    if (typeof exports === 'object'){
        if (module !== undefined && module.exports) {
            exports = module.exports = AgentAssistPubSub; // Node.js specific `module.exports`
        }
        exports.AgentAssistPubSub = AgentAssistPubSub; // CommonJS module 1.1.1 spec
        module.exports = exports = AgentAssistPubSub; // CommonJS
    }
    // AMD support
    /* eslint-disable no-undef */
    else if (typeof define === 'function' && define.amd){
        define(function() { return AgentAssistPubSub; });
        /* eslint-enable no-undef */
    }

}(( typeof window === 'object' && window ) || this, function (AgentAssistPubSub){
    'use strict';

    var messages = {},
        lastUid = -1,
        ALL_SUBSCRIBING_MSG = '*';

    function hasKeys(obj){
        var key;

        for (key in obj){
            if ( Object.prototype.hasOwnProperty.call(obj, key) ){
                return true;
            }
        }
        return false;
    }

    /**
     * Returns a function that throws the passed exception, for use as argument for setTimeout
     * @alias throwException
     * @function
     * @param { Object } ex An Error object
     */
    function throwException( ex ){
        return function reThrowException(){
            throw ex;
        };
    }

    function callSubscriberWithDelayedExceptions( subscriber, message, data ){
        try {
            subscriber( message, data );
        } catch( ex ){
            setTimeout( throwException( ex ), 0);
        }
    }

    function callSubscriberWithImmediateExceptions( subscriber, message, data ){
        subscriber( message, data );
    }

    function deliverMessage( originalMessage, matchedMessage, data, immediateExceptions ){
        var subscribers = messages[matchedMessage],
            callSubscriber = immediateExceptions ? callSubscriberWithImmediateExceptions : callSubscriberWithDelayedExceptions,
            s;

        if ( !Object.prototype.hasOwnProperty.call( messages, matchedMessage ) ) {
            return;
        }

        for (s in subscribers){
            if ( Object.prototype.hasOwnProperty.call(subscribers, s)){
                callSubscriber( subscribers[s], originalMessage, data );
            }
        }
    }

    function createDeliveryFunction( message, data, immediateExceptions ){
        return function deliverNamespaced(){
            var topic = String( message ),
                position = topic.lastIndexOf( '.' );

            // deliver the message as it is now
            deliverMessage(message, message, data, immediateExceptions);

            // trim the hierarchy and deliver message to each level
            while( position !== -1 ){
                topic = topic.substr( 0, position );
                position = topic.lastIndexOf('.');
                deliverMessage( message, topic, data, immediateExceptions );
            }

            deliverMessage(message, ALL_SUBSCRIBING_MSG, data, immediateExceptions);
        };
    }

    function hasDirectSubscribersFor( message ) {
        var topic = String( message ),
            found = Boolean(Object.prototype.hasOwnProperty.call( messages, topic ) && hasKeys(messages[topic]));

        return found;
    }

    function messageHasSubscribers( message ){
        var topic = String( message ),
            found = hasDirectSubscribersFor(topic) || hasDirectSubscribersFor(ALL_SUBSCRIBING_MSG),
            position = topic.lastIndexOf( '.' );

        while ( !found && position !== -1 ){
            topic = topic.substr( 0, position );
            position = topic.lastIndexOf( '.' );
            found = hasDirectSubscribersFor(topic);
        }

        return found;
    }

    function publish( message, data, sync, immediateExceptions ){
        message = (typeof message === 'symbol') ? message.toString() : message;

        var deliver = createDeliveryFunction( message, data, immediateExceptions ),
            hasSubscribers = messageHasSubscribers( message );

        if ( !hasSubscribers ){
            return false;
        }

        if ( sync === true ){
            deliver();
        } else {
            setTimeout( deliver, 0 );
        }
        return true;
    }

    /**
     * Publishes the message, passing the data to it's subscribers
     * @function
     * @alias publish
     * @param { String } message The message to publish
     * @param {} data The data to pass to subscribers
     * @return { Boolean }
     */
    AgentAssistPubSub.publish = function( message, data ){
        return publish( message, data, false, AgentAssistPubSub.immediateExceptions );
    };

    /**
     * Publishes the message synchronously, passing the data to it's subscribers
     * @function
     * @alias publishSync
     * @param { String } message The message to publish
     * @param {} data The data to pass to subscribers
     * @return { Boolean }
     */
    AgentAssistPubSub.publishSync = function( message, data ){
        return publish( message, data, true, AgentAssistPubSub.immediateExceptions );
    };

    /**
     * Subscribes the passed function to the passed message. Every returned token is unique and should be stored if you need to unsubscribe
     * @function
     * @alias subscribe
     * @param { String } message The message to subscribe to
     * @param { Function } func The function to call when a new message is published
     * @return { String }
     */
    AgentAssistPubSub.subscribe = function( message, func ){
        if ( typeof func !== 'function'){
            return false;
        }

        message = (typeof message === 'symbol') ? message.toString() : message;

        // message is not registered yet
        if ( !Object.prototype.hasOwnProperty.call( messages, message ) ){
            messages[message] = {};
        }

        // forcing token as String, to allow for future expansions without breaking usage
        // and allow for easy use as key names for the 'messages' object
        var token = 'uid_' + String(++lastUid);
        messages[message][token] = func;

        // return token for unsubscribing
        return token;
    };

    AgentAssistPubSub.subscribeAll = function( func ){
        return AgentAssistPubSub.subscribe(ALL_SUBSCRIBING_MSG, func);
    };

    /**
     * Subscribes the passed function to the passed message once
     * @function
     * @alias subscribeOnce
     * @param { String } message The message to subscribe to
     * @param { Function } func The function to call when a new message is published
     * @return { AgentAssistPubSub }
     */
    AgentAssistPubSub.subscribeOnce = function( message, func ){
        var token = AgentAssistPubSub.subscribe( message, function(){
            // before func apply, unsubscribe message
            AgentAssistPubSub.unsubscribe( token );
            func.apply( this, arguments );
        });
        return AgentAssistPubSub;
    };

    /**
     * Clears all subscriptions
     * @function
     * @public
     * @alias clearAllSubscriptions
     */
    AgentAssistPubSub.clearAllSubscriptions = function clearAllSubscriptions(){
        messages = {};
    };

    /**
     * Clear subscriptions by the topic
     * @function
     * @public
     * @alias clearAllSubscriptions
     * @return { int }
     */
    AgentAssistPubSub.clearSubscriptions = function clearSubscriptions(topic){
        var m;
        for (m in messages){
            if (Object.prototype.hasOwnProperty.call(messages, m) && m.indexOf(topic) === 0){
                delete messages[m];
            }
        }
    };

    /**
     Count subscriptions by the topic
    * @function
    * @public
    * @alias countSubscriptions
    * @return { Array }
    */
    AgentAssistPubSub.countSubscriptions = function countSubscriptions(topic){
        var m;
        // eslint-disable-next-line no-unused-vars
        var token;
        var count = 0;
        for (m in messages) {
            if (Object.prototype.hasOwnProperty.call(messages, m) && m.indexOf(topic) === 0) {
                for (token in messages[m]) {
                    count++;
                }
                break;
            }
        }
        return count;
    };


    /**
     Gets subscriptions by the topic
    * @function
    * @public
    * @alias getSubscriptions
    */
    AgentAssistPubSub.getSubscriptions = function getSubscriptions(topic){
        var m;
        var list = [];
        for (m in messages){
            if (Object.prototype.hasOwnProperty.call(messages, m) && m.indexOf(topic) === 0){
                list.push(m);
            }
        }
        return list;
    };

    /**
     * Removes subscriptions
     *
     * - When passed a token, removes a specific subscription.
     *
     * - When passed a function, removes all subscriptions for that function
     *
     * - When passed a topic, removes all subscriptions for that topic (hierarchy)
     * @function
     * @public
     * @alias subscribeOnce
     * @param { String | Function } value A token, function or topic to unsubscribe from
     * @example // Unsubscribing with a token
     * var token = AgentAssistPubSub.subscribe('mytopic', myFunc);
     * AgentAssistPubSub.unsubscribe(token);
     * @example // Unsubscribing with a function
     * AgentAssistPubSub.unsubscribe(myFunc);
     * @example // Unsubscribing from a topic
     * AgentAssistPubSub.unsubscribe('mytopic');
     */
    AgentAssistPubSub.unsubscribe = function(value){
        var descendantTopicExists = function(topic) {
                var m;
                for ( m in messages ){
                    if ( Object.prototype.hasOwnProperty.call(messages, m) && m.indexOf(topic) === 0 ){
                        // a descendant of the topic exists:
                        return true;
                    }
                }

                return false;
            },
            isTopic    = typeof value === 'string' && ( Object.prototype.hasOwnProperty.call(messages, value) || descendantTopicExists(value) ),
            isToken    = !isTopic && typeof value === 'string',
            isFunction = typeof value === 'function',
            result = false,
            m, message, t;

        if (isTopic){
            AgentAssistPubSub.clearSubscriptions(value);
            return;
        }

        for ( m in messages ){
            if ( Object.prototype.hasOwnProperty.call( messages, m ) ){
                message = messages[m];

                if ( isToken && message[value] ){
                    delete message[value];
                    result = value;
                    // tokens are unique, so we can just stop here
                    break;
                }

                if (isFunction) {
                    for ( t in message ){
                        if (Object.prototype.hasOwnProperty.call(message, t) && message[t] === value){
                            delete message[t];
                            result = true;
                        }
                    }
                }
            }
        }

        return result;
    };
}));

/* ------------------------------- PUBSUB ENDS HERE -------------------------- */
function sanitize(str) {
    str = str.replaceAll("\+", "__");
    return str;
}
function deSanitize(str) {
    str = str.replaceAll("__", "+");
    return str;
}

AgentAssistPubSub.subscribe('agent_assist_send_text', (msg, data) => {
    console.log("AgentAssist >>> sending value", data);
    var agent_assist_request = {
        'conversationId' : deSanitize(data.conversationId),
        'query' : data.value,
        'botId' : data.botId,
        'agentId' : data.agentId
    }
    if (data.intentName) {
        agent_assist_request['intentName'] = data.value;
    }

    _agentAsisstSocket.emit('agent_assist_request', agent_assist_request);
});